
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" itemscope itemtype="http://schema.org/Article">

<head>
	<!-- Meta Data -->
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-US" />

<!-- Icons -->
<link rel="apple-touch-icon" href="/list/lib/images/icons/32.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/list/lib/images/icons/72.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/list/lib/images/icons/114.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/list/lib/images/icons/144.png" />
<link rel='icon' href='/list/lib/images/icons/favicon.png' type='image/png' />

<script type="text/javascript">
	
	// Google Analytics
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-43641999-1', 'listicle.co');
	ga('send', 'pageview');
	
</script>
	<!-- CSS -->
<!-- 
<link rel="stylesheet" type="text/css" href="/list/lib/css/general.css" />
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/BookBlock/css/bookblock.css" />
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/scrollup/css/themes/image.css" />
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/perfect-scrollbar/src/perfect-scrollbar.css"/>
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/Swiper/dev/idangerous.swiper.css"/>
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/tagmanager/tagmanager.css"/>
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/fancyBox/source/jquery.fancybox.css?v=2.1.5" media="screen" />
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/bxslider/jquery.bxslider.css"/>
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/FlipClock/compiled/flipclock.css"/>
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/image-picker/image-picker.css"/>
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/video-js/video-js.min.css">
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/bootstrap/css/bootstrap.min.css"/>
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/webui-popover/src/jquery.webui-popover.css">
<link rel="stylesheet" type="text/css" href="/list/lib/plugins/rich-text-editor/src/js/jquery.notebook.css">
-->
<link rel="stylesheet" type="text/css" href="/list/lib/css/minified-web.css?version=18"/>

<!-- Javascript -->
<!--
<script type="text/javascript" src="/list/lib/javascript/jquery.min.js"></script>
<script type="text/javascript" src="/list/lib/javascript/jquery.cookie.js"></script>
<script type="text/javascript" src="/list/lib/javascript/forms/validations.js"></script>
<script type="text/javascript" src="/list/lib/javascript/device-detection.js"></script>
<script type="text/javascript" src="/list/lib/javascript/alert.js"></script>
<script type="text/javascript" src="/list/lib/javascript/dropdowns.js"></script>
<script type="text/javascript" src="/list/lib/javascript/user.js"></script>
<script type="text/javascript" src="/list/lib/javascript/jquery.imgCenter.minified.js"></script>
<script type="text/javascript" src="/list/lib/javascript/jquery.smoothZoom.min.js"></script>
<script type="text/javascript" src="/list/lib/javascript/jquery.form.min.js"></script>
<script type="text/javascript" src="/list/lib/javascript/jquery.sortable.js"></script>
<script type="text/javascript" src="/list/lib/javascript/embedly.js"></script>
<script type="text/javascript" src="/list/lib/javascript/html5shiv.js"></script>
<script type="text/javascript" src="/list/lib/plugins/Swipe/swipe.js"></script>
<script type="text/javascript" src="/list/lib/plugins/BookBlock/js/modernizr.custom.js"></script>
<script type="text/javascript" src="/list/lib/plugins/BookBlock/js/jquery.bookblock.js"></script>
<script type="text/javascript" src="/list/lib/plugins/scrollup/src/jquery.scrollUp.js"></script>
<script type="text/javascript" src="/list/lib/plugins/perfect-scrollbar/src/jquery.mousewheel.js"></script>
<script type="text/javascript" src="/list/lib/plugins/perfect-scrollbar/src/perfect-scrollbar.js"></script>
<script type="text/javascript" src="/list/lib/plugins/Swiper/dev/idangerous.swiper.js"></script>
<script type="text/javascript" src="/list/lib/plugins/fancyBox/source/jquery.fancybox.js?v=2.1.5"></script>
<script type="text/javascript" src="/list/lib/plugins/autosize/jquery.autosize.js"></script>
<script type="text/javascript" src="/list/lib/plugins/ion-sound/js/ion-sound/ion.sound.min.js"></script>
<script type="text/javascript" src="/list/lib/plugins/tagmanager/tagmanager.js"></script>
<script type="text/javascript" src="/list/lib/plugins/bxslider/jquery.bxslider.min.js"></script>
<script type="text/javascript" src="/list/lib/plugins/jquery-hotkeys/jquery.hotkeys.js"></script>
<script type="text/javascript" src="/list/lib/plugins/bootstrap-tagautocomplete/deps/bootstrap-typeahead.js"></script>
<script type="text/javascript" src="/list/lib/plugins/bootstrap-tagautocomplete/deps/rangy-core.js"></script>
<script type="text/javascript" src="/list/lib/plugins/bootstrap-tagautocomplete/deps/caret-position.js"></script>
<script type="text/javascript" src="/list/lib/plugins/bootstrap-tagautocomplete/bootstrap-tagautocomplete.js"></script>
<script type="text/javascript" src="/list/lib/plugins/FlipClock/compiled/flipclock.min.js"></script>
<script type="text/javascript" src="/list/lib/plugins/video-js/video.js"></script>
<script type="text/javascript" src="/list/lib/javascript/general.js"></script>
<script type="text/javascript" src="/list/lib/plugins/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/list/lib/javascript/jquery.backstretch.min.js"></script>
<script type="text/javascript" src="/list/lib/plugins/webui-popover/src/jquery.webui-popover.js"></script>
<script type="text/javascript" src="/list/lib/plugins/lazyload/jquery.lazyload.min.js"></script>
<script type="text/javascript" src="/list/lib/plugins/rich-text-editor/src/js/jquery.notebook.js"></script>
-->
<script type="text/javascript" src="/list/lib/javascript/minified-web.js?version=18"></script>
<script type="text/javascript">
	// Don't auto-select first search item
	$.fn.typeahead.Constructor.prototype.render = function (items) {
		var that = this;
		items = $(items).map(function (i, item) {
			i = $(that.options.item).attr('data-value', item);
			i.find('a').html(that.highlighter(item));
			return i[0];
		});
		this.$menu.html(items);
		return this;
	};

	// Search
	function search(item) {
		var query = "";
		if (item.length > 0) {
			query = item;
		} else {
			query = $("#search_box").val();
		}

		var type = getURLParameter('type').replace("<", "").replace(">", "");
		if (type == "people") {
			type = "people";
		} else {
			type = "lists";
		}
		window.location = "/list/search.php?type=" + type + "&query=" + query;
	}
</script>
		<meta name="apple-itunes-app" content="app-id=891447240, app-argument=listicle://listicle.co/l/?605002">
	<title>Donald Trump to meet Kim Jong Un in Hanoi in February and 8 More Stories You Might've Missed Today</title>
	<link rel="canonical" href="http://www.listicle.co/list/user/post.php?listid=605002">
	<link rel="author" href="http://www.listicle.co/list/user/profile.php?username=deutsche_welle">
	<link rel="publisher" href="http://plus.google.com/+ListicleCo">
	<meta name="title" content="Donald Trump to meet Kim Jong Un in Hanoi in February and 8 More Stories You Might've Missed Today" />
	<meta name="description" content=" Listed by @deutsche_welle." />
	<meta name="keywords" content="">
	<meta property="og:title" content="Donald Trump to meet Kim Jong Un in Hanoi in February and 8 More Stories You Might've Missed Today" />
	<meta property="og:site_name" content="Listicle" />
	<meta property="og:description" content=" Listed by @deutsche_welle." />
	<meta property="og:image" content="http://s3.listicle.co/production/list/storage/list/cover/display/4125871_1549716047.jpg" />
	<meta property="og:image:width" content="0" />
	<meta property="og:image:height" content="0" />
	<meta property="og:image:type" content="image/png" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="http://www.listicle.co/list/user/post.php?listid=605002" />
	<meta property="article:publisher" content="http://www.facebook.com/listicleco" />
	<meta property="article:author" content="http://www.listicle.co/list/user/profile.php?username=deutsche_welle">
	<meta property="article:published_time" content="2019-02-09T12:50:32+00:00">
	<meta property="fb:app_id" content="492497607499022" />
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="@listicleco" />
	<meta name="twitter:creator" content="@listicleco" />
	<meta name="twitter:url" content="http://www.listicle.co/list/user/post.php?listid=605002" />
	<meta name="twitter:title" content="Donald Trump to meet Kim Jong Un in Hanoi in February and 8 More Stories You Might've Missed Today" />
	<meta name="twitter:description" content=" Listed by @deutsche_welle." />
	<meta name="twitter:image:src" content="http://s3.listicle.co/production/list/storage/list/cover/display/4125871_1549716047.jpg" />
	<meta name="twitter:domain" content="listicle.co" />
	<meta itemprop="name" content="Donald Trump to meet Kim Jong Un in Hanoi in February and 8 More Stories You Might've Missed Today">
	<meta itemprop="description" content=" Listed by @deutsche_welle.">
	<meta itemprop="image" content="http://s3.listicle.co/production/list/storage/list/cover/display/4125871_1549716047.jpg"></head>

<body style='padding-top: 40px; padding-bottom: 0px;'>
	<div class="navbar navbar-fixed-top" style="background-color: #FFFFFF !important; background-image: none;">
	<div class="navbar-inner" style="background-color: #FFFFFF !important; background-image: none;">
		<div class="container" style="background-color: #FFFFFF !important; background-image: none;">
			<a class="brand" href="/list/index.php">
				<img src='/list/lib/images/logo/logo-large-inverse.png' alt='Listicle Logo' style='height: 25px;' />
			</a>
			<div class="nav-collapse collapse navbar-inverse-collapse">
				<div class='pull-right'>
					<form class="navbar-search" action='javascript:void(0)' onsubmit='return false;'>
						<input id="search_box" name="search_box" type="text" data-provide="typeahead" class="search-query span3" placeholder="Search" onkeydown="if (event.keyCode == 13) search('');" />
						<div class="icon-search">
						</div>
					</form>
					<ul class="nav pull-right">
						<li class="divider-vertical"></li>
						<li>
							<a rel="tooltip" id='explorePopover' name='explorePopover' href="#" data-toggle="popover" data-placement="bottom">
								<i class="icon-globe">
							</i>
								Discover
							</a>
						</li>
						<li class="divider-vertical"></li>
						<li>
							<a onclick='toggle_request_invite();' class='signup_link cursor-pointer' rel="tooltip">
								<i class="icon-user">
							</i>
								Request Invite
							</a>
						</li>
						<li class="divider-vertical"></li>
						<li>
							<a href="/list/signin.php" class='signin_link' rel="tooltip">
								<i class="icon-lock">
							</i>
								Log In
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="request-invite-modal" class="modal hide" tabindex="-1" role="dialog" style="width: 400px; margin-top: 150px !important; margin-left: -200px; height: 120px; text-align: center; background-color: transparent; border-color: transparent; box-shadow: none;">
	<form id='request_invitation_form' name='request_invitation_form' method="post" action='javascript:void(0)'>
	<input id='request_email' name='request_email' class='input-block-level input-large-web rounded' placeholder='Email Address'/>
	<div class='padding-top-5'></div>
	<button class='btn-blue-notification btn-large btn-block' onclick='submit_request_invite();'>Request an Invitation</button>
	<div class='image-transparent padding-top-10'>
		<small>To ensure quality content, Listicle is invite-only for list creators. You can request an invitation if you wish to create lists.</small>
	</div>
	</form>
</div>
<script type="text/javascript">
	
	// Explore
	var explorePopoverBody = "<div class='row-fluid' style='width: 300px;'>" + 
								"<div class='span6'>" + 
									"<div><a href='/list/user/topic.php?category=arts_literature'>Arts &amp; Literature </a></div>" + 
									"<div><a href='/list/user/topic.php?category=auto'>Auto</a></div>" + 
									"<div><a href='/list/user/topic.php?category=business_finance'>Business &amp; Finance</a></div>" + 
									"<div><a href='/list/user/topic.php?category=culture_faith'>Culture &amp; Faith</a></div>" + 
									"<div><a href='/list/user/topic.php?category=DIY'>DIY &amp; How-To</a></div>" + 
									"<div><a href='/list/user/topic.php?category=entertainment'>Entertainment</a></div>" + 
									"<div><a href='/list/user/topic.php?category=family'>Family</a></div>" + 
									"<div><a href='/list/user/topic.php?category=fashion_beauty'>Fashion &amp; Beauty</a></div>" + 
									"<div><a href='/list/user/topic.php?category=food_drinks'>Food &amp; Drink</a></div>" + 
									"<div><a href='/list/user/topic.php?category=funny'>Funny</a></div>" + 
									"<div><a href='/list/user/topic.php?category=games'>Games</a></div>" + 
									"<div><a href='/list/user/topic.php?category=general'>General</a></div>" + 
								"</div>" + 
								"<div class='span6'>" +
									"<div><a href='/list/user/topic.php?category=health_lifestyle'>Health &amp; Lifestyle</a></div>" + 
									"<div><a href='/list/user/topic.php?category=home_gardening'>Home &amp; Gardening</a></div>" + 
									"<div><a href='/list/user/topic.php?category=love_relationships'>Love &amp; Relationships</a></div>" + 
									"<div><a href='/list/user/topic.php?category=music'>Music</a></div>" + 
									"<div><a href='/list/user/topic.php?category=news_politics'>News &amp; Politics</a></div>" + 
									"<div><a href='/list/user/topic.php?category=pets_animals'>Pets &amp; Animals</a></div>" + 
									"<div><a href='/list/user/topic.php?category=photography_design'>Photography &amp; Design</a></div>" + 
									"<div><a href='/list/user/topic.php?category=science_nature'>Science &amp; Nature</a></div>" + 
									"<div><a href='/list/user/topic.php?category=sports'>Sports</a></div>" + 
									"<div><a href='/list/user/topic.php?category=technology'>Technology</a></div>" + 
									"<div><a href='/list/user/topic.php?category=travel'>Travel &amp; Tourism</a></div>" + 
									"<div><a href='/list/user/topic.php?category=tv_movies'>TV &amp; Movies</a></div>" + 
								"</div>" + 
							"</div>" + 
							"<a href='/list/user/topic.php?category=all' class='btn btn-blue-notification btn-block bold'>All Topics</a>" + 
							"<div class='padding-5'></div>" + 
							"<div class='padding-top-5 centered' style='border-top: 1px solid rgba(0, 0, 0, 0.1);'><small><a href='/list/about.php'>About</a> &middot; <a href='/list/team.php'>Team</a> &middot; <a href='/list/terms.php'>Terms</a> &middot; <a href='/list/policy.php'>Policy</a> &middot; <a href='/list/lists.php'>Lists</a></small></div>";
	$(function(){$("#explorePopover").popover({content: explorePopoverBody, html:true})});
	$(document).mouseup(function (e)
	{
	    var container = $("#explorePopover");
		if (!container.is(e.target) && container.has(e.target).length === 0)
	    {
	        $("#explorePopover").popover("hide");
	    }
	});
	
	// Search
	var url_type = getURLParameter('type').replace("<", "").replace(">", "");
	if (url_type == "people") {
		url_type = "user";
	} else {
		url_type = "list";
	}
	var search_signed_out_url = "/list/get/search/" + url_type + "_autocomplete.php";
	$('#search_box').typeahead({
		source: function (query, process) {
			$.ajax({
				url: search_signed_out_url,
				type: 'POST',
				dataType: 'JSON',
				data: 'query=' + query,
				success: function (data) {
					process(data);
				}
			});
		},
		updater: function (item) {
			search(item.toString());
		}
	});
	
	// Add redirect parameter to signin and signup links
	var redirect_url = getURLParameter('redirect');
	if(redirect_url.length > 0)
	{
		$(".signup_link").attr("href", "/list/index.php?page=signup&redirect=" + redirect_url)
		$(".signin_link").attr("href", "/list/index.php?page=signin&redirect=" + redirect_url)
	}
	
	function toggle_request_invite()
	{
		$("#request-invite-modal").modal("toggle");
	}
	
	function submit_request_invite()
	{
		if(validate_email($("#request_email").val()))
		{
			var submit_url = "/list/forms/invitations/request_invitations.php";
			$.post(submit_url, $("#request_invitation_form").serialize(), function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					toggle_request_invite();
					device_success(notice.message);
				} else if (notice.error == 1) {
					device_alert(notice.message);
				}
			});
		}
		else
		{
			device_alert("Please enter a proper email address!");
		}
	}
		
	// Invite an email
	function request_invite(id) 
	{
		if(validate_email($("#request_email_" + id).val()))
		{
			var submit_url = "/list/forms/invitations/request_invitations.php";
			$.post(submit_url, $("#request_invitation_form_" + id).serialize(), function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					device_success(notice.message);
					toggle_request_invite();
				} else if (notice.error == 1) {
					device_alert(notice.message);
				}
			});
		}
		else
		{
			device_alert("Please enter a proper email address!");
		}
	}
</script>	<div id="listFirstPopup" class="modal hide fade" tabindex="-1" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="listFirstLabel">
	<div class="modal-header" style='padding-bottom: 0px;'>
		<input type="text" placeholder="List Title" class='title-web input-block-level' id='list_title_first' name='list_title_first' onblur='copy_list_title("first"); update_list_title("first");'/>
	</div>
	<div class="modal-body" id='list_body' name='list_body' style='max-height: 300px;'>
		<ol id='list_items' name='list_items' class="drag_drop_list">
		</ol>
		<div id='create-list-default' class='centered'>
			<img src='/list/lib/images/default/create-list.png'/>
		</div>
		<div id='reorder_items' class='muted centered' style='display: none;'>Note: You can re-order your list by dragging the black item number buttons.</div>
		<input type='hidden' id='list_order' name='list_order' value='' />
	</div>
	<div class="modal-footer">
		<div>
			<div class="btn-group" style='width: 100%;'>
				<button style='width: 25%;' onclick='add_item("photos");' name="list_type_button" type="button" class="btn btn-large" value='photos' rel="tooltip" title="Add a Photo"><i class="icon-camera"></i></button>
				<button style='width: 25%;' onclick='add_item("videos");' name="list_type_button" type="button" class="btn btn-large" value='videos' rel="tooltip" title="Add a Video"><i class="icon-facetime-video"></i></button>
				<button style='width: 25%;' onclick='add_item("links");' name="list_type_button" type="button" class="btn btn-large" value='links' rel="tooltip" title="Add a Link"><i class="icon-globe"></i></button>
				<button style='width: 25%;' onclick='add_item("text");' name="list_type_button" type="button" class="btn btn-large" value='text' rel="tooltip" title="Add Text"><i class="icon-font"></i></button>
			</div>
		</div>
		<hr/>
		<div>
			<a class="btn pull-left" role="button" type="button" data-dismiss="modal" style='width: 60px;' onclick='enable_navigation(); submit_update_items("");'>Cancel</a>
			<a class="btn btn-inverse" style='width: 60px;' onclick='submit_update_items(""); submit_publish_list("preview");'>Preview</a>
			<a id='reorder_button' name='reorder_button' class="btn btn-inverse" style='width: 60px;' onclick='submit_update_items(""); reorder();'>Reorder</a>
			<a class="btn btn-blue-notification" style='width: 60px;' onclick='copy_list_title("first"); submit_update_items("next");'>Next</a>
		</div>
	</div>
</div>
<div id="listSecondPopup" class="modal hide fade" data-backdrop="static" data-keyboard="false" aria-labelledby="listSecondLabel">
	<div class="modal-header" style='padding-bottom: 0px;'>
		<input type="text" placeholder="List Title" class='title-web input-block-level' id='list_title_second' name='list_title_second' onblur='copy_list_title("second"); update_list_title("second");'/>
	</div>
	<div class="modal-footer">
		<a class="fancybox fancybox.iframe" id='preview' name='preview' style='display: none;'></a>
		<div id='loadcover' name='loadcover'></div>
		<div class="row-fluid" style='padding: 0px;'>
			<div class="span6">
				<form enctype="multipart/form-data" id="cover_upload_form" name="cover_upload_form" method="post" action="/list/forms/upload/list/cover.php">
					<div class="fileupload fileupload-new" data-provides="fileupload"><span class="btn btn-file btn-block"><span class="fileupload-new"><i class="icon-picture"></i> Upload Cover Photo</span><span class="fileupload-exists"><i class="icon-picture"></i> Change Cover Photo</span>
						<input type="file" name="cover_photo_upload" id="cover_photo_upload" onchange="submit_cover_photo();" />
						</span>
					</div>
				</form>
			</div>
			<div class="span3">
				<button class="btn btn-block" onclick="gif_open('cover');"><i class="icon-search"></i> GIFs</button>
			</div>
			<div class="span3">
				<input type="text" placeholder="Paste Cover Link" class="input-block-level" onblur="submit_cover_photo_link()" id="cover_image_link" name="cover_image_link">
			</div>
		</div>
		<form id='share_list_form' name='share_list_form' method="post" action='javascript:void(0)' onsubmit="return false;">
			<div class="row-fluid" style='padding: 0px;'>
				<div class='span6'>
					<div class="btn-group" data-toggle="buttons-radio" style='width: 100%;'>
						<button name="list_visibility_button" type="button" class="btn active" style='width: 50%;' value='public'><i class="icon-globe"></i> Public</button>
						<button name="list_visibility_button" type="button" class="btn" style='width: 50%;' value='private'><i class="icon-lock"></i> Private</button>
					</div>
				</div>
				<div class='span6'>
					<select class='input-block-level' id='list_category' name='list_category'>
						<option value='general'>
							List Category
						</option>
					</select>
				</div>
			</div>
			<textarea class="boxsizingBorder textarea-animated" rows="1" placeholder="List Description (Optional)" id="list_description" name="list_description" style="width: 100%; max-height: 200px;"></textarea>
			<div style='padding: 0px; padding-bottom: 5px;' class='show_more'>
				<a class="btn btn-block" onclick='show_more_options();'><i>Show more options</i></a>
			</div>
			<div style='padding: 0px; text-align: left; display: none;' class='show_more'>
				<input type="text" placeholder="Tag People (Usernames)" class="tm-input tm-input-success input-block-level" id='people_tags' name='people_tags'>
			</div>
			<div style='padding: 0px; text-align: left; padding-top: 5px; display: none;' class='show_more'>
				<input type="text" placeholder="Tag Keywords, Topics and Phrases" class="tm-input tm-input-info input-block-level" id='keyword_tags' name='keyword_tags'>
			</div>
			<div class="row-fluid" style='padding: 0px; padding-top: 5px;'>
				<div class='span6'>
					<div class="btn-group" data-toggle="buttons-radio" style='width: 100%;'>
						<button name="list_format_button" type="button" class="btn" style='width: 20%;' value='plain' rel="tooltip" title="Plain"><i class="icon-plain"></i></button>
						<button name="list_format_button" type="button" class="btn active" style='width: 21%;' value='numbered' rel="tooltip" title="Numbered"><i class="icon-numbered"></i></button>
						<button name="list_format_button" type="button" class="btn" style='width: 20%;' value='countdown' rel="tooltip" title="Countdown"><i class="icon-countdown"></i></button>
						<button name="list_format_button" type="button" class="btn" style='width: 20%;' value='rankable' rel="tooltip" title="Rankable"><i class="icon-rankable"></i></button>
						<button name="list_format_button" type="button" class="btn" style='width: 20%;' value='checklist' rel="tooltip" title="Checklist"><i class="icon-checklist"></i></button>
					</div>
				</div>
				<div class='span6'>
					<div class="btn-group btn-block centered" data-toggle="buttons-checkbox" style="width: 100%;">
						<button onclick='check_social("facebook")' name="list_social_button" type="button" class="btn" style='width: 26%;' value='facebook' rel="tooltip" title="Facebook">
							<img src="/list/lib/images/social/facebook.png" style="width: 18px;" />
						</button>
						<button onclick='check_social("twitter")' name="list_social_button" type="button" class="btn" style='width: 25%;' value='twitter' rel="tooltip" title="Twitter">
							<img src="/list/lib/images/social/twitter.png" style="width: 18px;" />
						</button>
						<button onclick='check_social("linkedin")' name="list_social_button" type="button" class="btn" style='width: 25%;' value='linkedin' rel="tooltip" title="LinkedIn">
							<img src="/list/lib/images/social/linkedin.png" style="width: 18px;" />
						</button>
						<button onclick='check_social("tumblr")' name="list_social_button" type="button" class="btn" style='width: 25%;' value='tumblr' rel="tooltip" title="Tumblr">
							<img src="/list/lib/images/social/tumblr.png" style="width: 18px;" />
						</button>
					</div>
				</div>
			</div>
			<div style='padding: 0px; display: none;' id="email_box">
				<input type="text" placeholder="Email Addresses. Example: abc@email.com, xyz@email.com" class='input-block-level' id='list_emails' name='list_emails' onkeydown="if (event.keyCode == 13) submit_publish_list("");">
			</div>
			<div class="row-fluid" style='padding: 0px; display: none;' id="text_box">
				<div class='span3'>
					<select class='input-block-level' id='list_country_code' name='list_country_code'>
						<option value='1'>
							Country
						</option>
					</select>
				</div>
				<div class='span9'>
					<input type="text" placeholder="Mobile Phone Numbers (Max 5). Example: 1234567890" class='input-block-level' id='list_phone_numbers' name='list_phone_numbers' onkeydown="if (event.keyCode == 13) submit_publish_list("");">
				</div>
			</div>
			<div id='loadshare' name='loadshare'></div>
			<input type='hidden' id='list_id' name='list_id' value='' />
			<input type='hidden' id='list_format' name='list_format' value='' />
			<input type='hidden' id='list_design' name='list_design' value='list' />
			<input type='hidden' id='list_visibility' name='list_visibility' value='' />
			<input type='hidden' id='list_social' name='list_social' value='' />
		</form>
		<hr/>
		<div>
			<a class="btn pull-left" role="button" type="button" data-dismiss="modal" data-toggle="modal" style='width: 60px;' href="#listFirstPopup" onclick='copy_list_title("second");'>Back</a>
			<a class="btn btn-inverse" style='width: 60px;' onclick='submit_publish_list("preview");'>Preview</a>
			<a class="btn btn-inverse" type="button" data-dismiss="modal" style='width: 70px;' onclick="enable_navigation(); submit_publish_list('save');">Save Draft</a>
			<a class="btn btn-blue-notification" type="submit" style='width: 60px;' onclick='submit_publish_list("");' id='publish_button' name='publish_button'>Publish</a>
		</div>
	</div>
</div>
<div id="gifSearchPopup" class="modal hide fade" tabindex="-1" data-backdrop="static" role="dialog" data-keyboard="false" aria-labelledby="gifSearchLabel" style='width: 484px !important; margin-left: -245px;'>
	<div class="modal-header">
		<h3>Find &amp; Select a GIF</h3>
	</div>
	<div class="modal-body" id='gif_body' name='gif_body'>
		<div class="input-append">
		  <input style='width: 310px;' id='gif_search' type='text' onkeydown="if (event.keyCode == 13) gif_search();" placeholder="Search GIFs by Keywords"></input>
		  <button id='gif_search_button' style='width: 130px;' class="btn " type="button" onclick='gif_search();'>Search</button>
		</div>
		<div class="row-fluid" id='gif-box' style='display: none;'>
		  <div class="span6" id='gif-box-left'></div>
		  <div class="span6" id='gif-box-right'></div>
		</div>
		<div id='gif_loading'></div>
	</div>
	<div class="modal-footer">
		<div>
			<a href='http://www.giphy.com/' target='_blank'><img src='/list/lib/images/logo/giphy.gif' class='pull-left'/></a>
			<a class="btn" role="button" type="button" data-dismiss="modal" style='width: 60px;' onclick='toggle_first_popup();'>Cancel</a>
			<a class="btn btn-success" style='width: 60px;' onclick='gif_selected();'>Okay</a>
		</div>
	</div>
</div>
<script type="text/javascript">
	// Initializations
	var userData = getUserData();
	var username = userData.username;
	var userpass = userData.userpass;
	var list_id = getURLParameter('listid').replace("<", "").replace(">", "");
	var list_format = "";
	var list_count = 0;
	var list_item_id = "";
	var list_title = "";
	var list_category = "";
	var list_description = "";
	var list_design = "";
	var list_cover = "";
	var list_visibility = "";
	var list_tags = "";
	var list_keywords = "";
	var list_citations = "";
	var list_items_array = new Array();
	var loading_cover = false;
	var gif_loading = 0;
	var gif_item = "";
	var gif_keywords = "";
	var gifs_array = new Array();
	var gif_page = 0;
	var gif_left_height = 0;
	var gif_right_height = 0;
	var facebook_connected = 0;
	var twitter_connected = 0;
	var linkedin_connected = 0;
	var tumblr_connected = 0;

	// Initializations
	dropdown_categories("list_category");
	dropdown_country_phone_codes("list_country_code");
	$('.fancybox').fancybox();
	$(".fancybox").click(function (e) {
		e.preventDefault();
	});

	// Autogrow
	$('#list_description').autosize({
		append: "\n"
	});

	// Sortable
	$("ol.drag_drop_list").sortable({
		handle: 'span.drag_drop_handle',
		onDrop: function ($item, container, _super) {
			$item.removeClass("dragged").removeAttr("style")
			$("body").removeClass("dragging")
			renumber_items()
		}
	});
	
	// Get social data
	$.get('/list/get/user/social.php?username=' + username, function(data) { 	
	  	userSocial = jQuery.parseJSON(data);
	  	facebook_connected = userSocial.facebook;
	  	twitter_connected = userSocial.twitter;
	  	linkedin_connected = userSocial.linkedin;
	  	tumblr_connected = userSocial.tumblr;
	});
	
	// Toggle first popup
	function toggle_first_popup()
	{
		$('#listFirstPopup').modal('toggle');
	}
	
	// Toggle second popup
	function toggle_second_popup()
	{
		$('#listSecondPopup').modal('toggle');
	}

	// Reorder items
	function reorder() {
		$("#reorder_items").toggle();
		$(".reorder").toggle();
	}

	// Disable page navigation
	function disable_navigation() {
		$(window).bind('beforeunload', function () {
			return "You haven't finished your list yet!";
		});
	}

	// Enable page navigation
	function enable_navigation() {
		$(window).unbind("beforeunload");
	}
	
	// Uploading one or multiple items
	function items_upload_select(multiple)
	{
		if(multiple == "multiple")
		{
			$("#add_item_button").hide();
			$("#multiple_upload_button").show();
		}
		else
		{
			$("#add_item_button").show();
			$("#multiple_upload_button").hide();
		}
	}

	function submit_cover_photo() {
		loading_cover = true;
		if ($("#cover_photo_upload").val().length > 0) {
			show_loading("loadcover");
			$('#cover_upload_form').ajaxSubmit({
				data: {
					list_id: list_id
				},
				success: function (data) {
					var notice = jQuery.parseJSON(data);
					if (notice.error == 0) {
						var file = amazon_get_file("/list/storage/list/cover/display/" + notice.file);
						$('.list_cover_photo').css("background-image", "url(" + file + ")");
					} else if (notice.error == 1) {
						device_alert(notice.message);
					}
					hide_loading();
					loading_cover = false;
				},
				error: function (data) {loading_cover = false;}
			});
		}
		else
		{
			loading_cover = false;
		}
	}

	function submit_cover_photo_link() {
		loading_cover = true;
		jQuery.ajaxSetup({
			async: true
		});

		// Initialize
		var cover_link = $("#cover_image_link").val();
		var submit_url = "/list/forms/scrape/list/cover.php?username=" + username + "&userpass=" + userpass;
		if (cover_link.length <= 0) {
			loading_cover = false;
			return false;
		}

		show_loading("loadcover")
		$.post(submit_url, {
			list_id: list_id,
			cover_link: cover_link
		}, function (data) {
			var notice = jQuery.parseJSON(data);
			if (notice.error == 0) {
				var file = amazon_get_file("/list/storage/list/cover/display/" + notice.file);
				$('.list_cover_photo').css("background-image", "url(" + file + ")");
			} else if (notice.error == 1) {
				device_alert(notice.message);
			}
			hide_loading();
			loading_cover = false;
		});
	}

	// Toggle email/texting box display
	function toggle_display(box) {
		$("#" + box).toggle();
	}

	// Delete list item
	function delete_item(item_number) {
		jQuery.ajaxSetup({
			async: true
		});
		$('#list_item_' + item_number).remove();
		list_count--;
		if(list_count <= 0)
		{
			$("#create-list-default").show();
		}
		var index = list_items_array.indexOf(item_number);
		list_items_array.splice(index, 1);
		renumber_items();
		var submit_url = "/list/forms/list/delete_item.php?username=" + username + "&userpass=" + userpass;
		$.post(submit_url, {
			id: item_number
		}, function (data) {
			var notice = jQuery.parseJSON(data);
			if (notice.error == 1) {
				device_alert(notice.message);
			}
		});
	}

	// Renumber items
	function renumber_items() {
		list_items_array = new Array();
		var count = 1;
		$("span[id^=item_count_]").each(function () {
			//
			var item_id = $(this).attr('id').replace("item_count_", "");
			list_items_array.push(item_id);

			// Set the order
			$(this).html(count);
			count++;
		});
	}

	function submit_item_photo(item_id) {
		jQuery.ajaxSetup({
			async: true
		});
		$('#item_image_' + item_id).attr("src", "/list/lib/images/loading/display_loading.gif");
		$('#item_upload_form_' + item_id).ajaxSubmit({
			data: {
				username: username,
				item_id: item_id
			},
			error: function (data) {
				console.log(data);
			},
			success: function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					var file = amazon_get_file("/list/storage/list/item/thumbnail/" + notice.file);
					$('#item_image_' + item_id).attr("src", file);
					$('#item_image_file_' + item_id).val(notice.file);
				} else if (notice.error == 1) {
					$('#item_image_' + item_id).attr("src", "/list/lib/images/default/no-image-thumbnail.png");
					device_alert(notice.message);
				}
			}
		});
	}

	function submit_item_photo_link(item_id) {
		jQuery.ajaxSetup({
			async: true
		});

		// Initialize
		var item_link = $("#item_image_link_" + item_id).val();
		var submit_url = "/list/forms/scrape/list/item.php?username=" + username + "&userpass=" + userpass;
		if (item_link.length <= 0) {
			return false;
		}

		$('#item_image_' + item_id).attr("src", "/list/lib/images/loading/display_loading.gif");
		$.post(submit_url, {
			username: username,
			item_id: item_id,
			item_link: item_link
		}, function (data) {
			var notice = jQuery.parseJSON(data);
			if (notice.error == 0) {
				if (notice.file.length > 0) {
					var file = amazon_get_file("/list/storage/list/item/thumbnail/" + notice.file);
					$('#item_image_' + item_id).attr("src", file);
					$('#item_image_file_' + item_id).val(notice.file);
				} else {
					$('#item_image_' + item_id).attr("src", "/list/lib/images/default/no-image-thumbnail.png");
				}
			} else if (notice.error == 1) {
				$('#item_image_' + item_id).attr("src", "/list/lib/images/default/no-image-thumbnail.png");
				device_alert(notice.message);
			}
		});
	}

	function submit_item_link(item_id) {
		jQuery.ajaxSetup({
			async: true
		});

		// Initialize
		var item_link = $("#item_link_" + item_id).val();
		var submit_url = "/list/forms/scrape/list/item.php?username=" + username + "&userpass=" + userpass;
		if (item_link.length <= 0) {
			return false;
		}

		$('#item_link_image_' + item_id).attr("src", "/list/lib/images/loading/display_loading.gif");
		$.post(submit_url, {
			username: username,
			item_id: item_id,
			item_link: item_link
		}, function (data) {
			var notice = jQuery.parseJSON(data);
			if (notice.error == 0) {
				if (notice.file.length > 0) {
					var file = amazon_get_file("/list/storage/list/item/thumbnail/" + notice.file);
					$('#item_link_image_' + item_id).attr("src", file);
					$('#item_image_file_' + item_id).val(notice.file);
				} else {
					$('#item_link_image_' + item_id).attr("src", "/list/lib/images/default/no-image-thumbnail.png");
				}
				$('#item_link_title_' + item_id).html(notice.title);
				$('#item_link_description_' + item_id).html(notice.description);
			} else if (notice.error == 1) {
				$('#item_link_image_' + item_id).attr("src", "/list/lib/images/default/no-image-thumbnail.png");
				device_alert(notice.message);
			}
		});
	}

	// Update list items
	function add_item(type) {
		$("#create-list-default").hide(function(){
		var item_type = type;
		jQuery.ajaxSetup({
			async: true
		});
		var submit_url = "/list/forms/list/add_item.php?username=" + username + "&userpass=" + userpass;
		$.post(submit_url, {
			username: username,
			listid: list_id
		}, function (data) {
			var notice = jQuery.parseJSON(data);
			if (notice.error == 0) {
				list_item_id = notice.list_item_id;
				list_items_array.push(list_item_id);

				// Type specific UI elements
				if (item_type == "text") {
					var newItem = [
						'<li id="list_item_' + list_item_id + '" class="drag_drop_list">',
						'<div class="prettyprint padding-10">',
						'  	<div class="row-fluid">',
						'  		<div class="span1"><span class="btn btn-inverse btn-block drag_drop_handle" id="item_count_' + list_item_id + '">' + list_count + '</span></div>',
						'	  	<div class="span10"><input type="text" placeholder="Item Title" class="input-block-level" id="item_title_' + list_item_id + '" name="item_title_' + list_item_id + '" onblur="submit_update_items(\'\');"></div>',
						'	    <div class="span1"><button type="button" class="btn btn-block" onclick="delete_item(' + list_item_id + ');"><i class="icon-remove"></i></button></div>',
						'	</div>',
						'	<div class="reorder">',
						'		<textarea class="boxsizingBorder textarea-animated" rows="2" placeholder="Item Description (Optional)" id="item_description_' + list_item_id + '" name="item_description_' + list_item_id + '" style="width: 100%;" onblur="submit_update_items(\'\');"></textarea>',
						'	</div>',
						'</div>',
						'<br/>',
						'<input type="hidden" id="item_type_' + list_item_id + '" name="item_type_' + list_item_id + '" value="' + item_type + '"/>',
						'</li>'
					].join('\n');
				} else if (item_type == "photos") {
					var newItem = [
						'<li id="list_item_' + list_item_id + '" class="drag_drop_list">',
						'<div class="prettyprint padding-10">',
						'  	<div class="row-fluid">',
						'  		<div class="span1"><span class="btn btn-inverse btn-block drag_drop_handle" id="item_count_' + list_item_id + '">' + list_count + '</button></div>',
						'	  	<div class="span10"><input type="text" placeholder="Item Title" class="input-block-level" id="item_title_' + list_item_id + '" name="item_title_' + list_item_id + '" onblur="submit_update_items(\'\');"></div>',
						'	    <div class="span1"><button type="button" class="btn btn-block" onclick="delete_item(' + list_item_id + ');"><i class="icon-remove"></i></button></div>',
						'	</div>',
						'	<div class="row-fluid reorder">',
						'		<div class="span4" style="padding-right: 10px;"><div style="max-width: 175px;"><img src="/list/lib/images/default/no-image-thumbnail.png" class="img-polaroid" id="item_image_' + list_item_id + '" name="item_image_' + list_item_id + '"/></div></div>',
						'		<div class="span8">',
						'			<div class="row-fluid">',
						'			  	<div class="span3"><form enctype="multipart/form-data" id="item_upload_form_' + list_item_id + '" name="item_upload_form_' + list_item_id + '" method="post" action="/list/forms/upload/list/item.php"><div class="fileupload fileupload-new" data-provides="fileupload"><span class="btn btn-file btn-block"><span class="fileupload-new"><i class="icon-picture"></i> Upload</span><span class="fileupload-exists"><i class="icon-picture"></i> Change</span><input class="upload" type="file" name="item_photo_upload" id="item_photo_upload" onchange="submit_item_photo(' + list_item_id + ');"/></span></div></form></div>',
						'			  	<div class="span1" style="text-align: center;"><span class="lead">or</span></div>',
						'			  	<div class="span3"><button class="btn btn-block" onclick="gif_open(' + list_item_id + ');"><i class="icon-search"></i> GIFs</button></div>',
						'			  	<div class="span1" style="text-align: center;"><span class="lead">or</span></div>',
						'			    <div class="span4"><input type="text" placeholder="Paste Link" class="input-block-level" onblur="submit_item_photo_link(' + list_item_id + ');" id="item_image_link_' + list_item_id + '" name="item_image_link_' + list_item_id + '"></div>',
						'			</div>',
						'			<div>',
						'				<textarea class="boxsizingBorder textarea-animated" rows="2" placeholder="Item Description (Optional)" id="item_description_' + list_item_id + '" name="item_description_' + list_item_id + '" style="width: 100%;" onblur="submit_update_items(\'\');"></textarea>',
						'			</div>',
						'		</div>',
						'	</div>',
						'</div>',
						'<br/>',
						'<input type="hidden" id="item_type_' + list_item_id + '" name="item_type_' + list_item_id + '" value="' + item_type + '"/>',
						'<input type="hidden" id="item_image_file_' + list_item_id + '" name="item_image_file_' + list_item_id + '" value=""/>',
						'</li>'
					].join('\n');
				} else if (item_type == "links" || item_type == "videos" || item_type == "audios") {
					var newItem = [
						'<li id="list_item_' + list_item_id + '" class="drag_drop_list">',
						'<div class="prettyprint padding-10">',
						'  	<div class="row-fluid">',
						'  		<div class="span1"><span class="btn btn-inverse btn-block drag_drop_handle" id="item_count_' + list_item_id + '">' + list_count + '</button></div>',
						'	  	<div class="span10"><input type="text" placeholder="Item Title" class="input-block-level" id="item_title_' + list_item_id + '" name="item_title_' + list_item_id + '" onblur="submit_update_items(\'\');"></div>',
						'	    <div class="span1"><button type="button" class="btn btn-block" onclick="delete_item(' + list_item_id + ');"><i class="icon-remove"></i></button></div>',
						'	</div>',
						'	<div class="reorder">',
						'		<input type="text" placeholder="Item Link" class="input-block-level" onblur="submit_item_link(' + list_item_id + '); submit_update_items(\'\');" id="item_link_' + list_item_id + '" name="item_link_' + list_item_id + '">',
						'	</div>',
						'	<div class="reorder">',
						'		<textarea class="boxsizingBorder textarea-animated" rows="2" placeholder="Item Description (Optional)" id="item_description_' + list_item_id + '" name="item_description_' + list_item_id + '" style="width: 100%;" onblur="submit_update_items(\'\');"></textarea>',
						'	</div>',
						'	<div id="list_link_' + list_item_id + '" name="list_link_' + list_item_id + '" class="row-fluid reorder">',
						'		<div class="span4" style="padding-right: 10px;"><div style="max-width: 175px;"><img src="/list/lib/images/default/no-image-thumbnail.png" class="img-polaroid" id="item_link_image_' + list_item_id + '" name="item_link_image_' + list_item_id + '"/></div></div>',
						'		<div class="span8">',
						'			<div class="padding-bottom-10">',
						'				<strong id="item_link_title_' + list_item_id + '" name="item_link_title_' + list_item_id + '">Title of the Link</strong>',
						'			</div>',
						'			<small>',
						'			<div class="padding-bottom-10 muted" id="item_link_description_' + list_item_id + '" name="item_link_description_' + list_item_id + '">',
						'				Description of the Link. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim ...',
						'			</div>',
						'			</small>',
						'		</div>',
						'	</div>',
						'</div>',
						'<br/>',
						'<input type="hidden" id="item_type_' + list_item_id + '" name="item_type_' + list_item_id + '" value="' + item_type + '"/>',
						'<input type="hidden" id="item_image_file_' + list_item_id + '" name="item_image_file_' + list_item_id + '" value=""/>',
						'</li>'
					].join('\n');
				}

				// Add the item + Scroll
				$('#list_items').append(newItem);
				$('#list_body').stop().animate({
					scrollTop: $("#list_body")[0].scrollHeight
				}, 1000);

				// Autogrow
				$('#item_description_' + list_item_id).autosize({
					append: "\n"
				});
			} else if (notice.error == 1) {
				device_alert(notice.message);
			}
		});
		list_count++;
		});
	}

	// Update list
	function update_list() {
		// Get the List and fill up the forms
		jQuery.ajaxSetup({async:false});
		var get_list_url = "/list/get/list/list.php?id=" + list_id;
		$.get(get_list_url, function (data) {

			// Initializations
			var json = jQuery.parseJSON(data);
			list_format = json.format;
			list_title = strip_tags(json.title.toString());
			list_category = json.category;
			list_description = strip_tags(json.description.toString());
			list_design = "list";
			list_cover = json.cover_photo;
			list_visibility = json.visibility;
			list_tags = json.tags;
			list_keywords = json.keywords;
			list_citations = json.citations;
			list_count = 0;

			// Filling the basic forms
			$("#list_id").val(list_id);
			$("#list_title_first").val(list_title);
			$("#list_title_second").val(list_title);
			$("#list_category").val(list_category);
			$("#list_description").val(list_description);
			$('button[name="list_format_button"][value="' + list_format + '"]').button('toggle');
			var file = amazon_get_file("/list/storage/list/cover/display/" + list_cover);
			$('.list_cover_photo').css("background-image", "url(" + file + ")");

			// People Tags
			jQuery("#people_tags").tagsManager({
				prefilled: list_tags,
				onlyTagList: true
			});
			var search_url = "/list/get/search/user_autocomplete.php";
			$('#people_tags').typeahead({
				source: function (query, process) {
					$.ajax({
						url: search_url,
						type: 'POST',
						dataType: 'JSON',
						data: 'query=' + query,
						success: function (data) {
							process(data);
						}
					});
				},
				updater: function (item) {
					item = item.substring(item.indexOf('@') + 1);
					jQuery("#people_tags").tagsManager("pushTag", item.substring(item.indexOf('@') + 1));
				}
			});

			// Keyword Tags
			jQuery("#keyword_tags").tagsManager({
				prefilled: list_keywords
			});

			// Citations
			jQuery("#citation_tags").tagsManager({
				prefilled: list_citations
			});

			// Add the items
			add_list_items(json.items);

			// Disable navigation
			disable_navigation();
		});
		jQuery.ajaxSetup({async:true});
		renumber_items();
	}

	function add_list_items(items) {
		$("#create-list-default").hide();
		var json = items;
		$('#list_items').html("");
		$.each(items, function (index) {
			var itemID = json[index].id;
			var list_item_id = itemID;
			var itemTitle = escapeHtml(strip_tags(json[index].title.toString()));
			var itemType = json[index].type;
			var itemDescription = strip_tags(json[index].description.toString());
			var itemImage = json[index].image;
			var itemLinkTitle = json[index].link_title;
			var itemLinkDescription = json[index].link_description;
			var itemVideo = json[index].video;
			var itemLink = json[index].link;
			if(itemVideo.length > 0)
			{
				itemLink = amazon_get_file("/list/storage/list/item/display/" + itemVideo);
			}
			var imageURL = "/list/lib/images/default/no-image-thumbnail.png";
			if (itemImage.length > 0) {
				imageURL = amazon_get_file("/list/storage/list/item/thumbnail/" + itemImage);
			}

			// Type specific UI elements
			if (itemType == "text") {
				var newItem = [
					'<li id="list_item_' + list_item_id + '" class="drag_drop_list">',
					'<div class="prettyprint padding-10">',
					'  	<div class="row-fluid">',
					'  		<div class="span1"><span class="btn btn-inverse btn-block drag_drop_handle" id="item_count_' + list_item_id + '">' + list_count + '</span></div>',
					'	  	<div class="span10"><input type="text" placeholder="Item Title" class="input-block-level" id="item_title_' + list_item_id + '" name="item_title_' + list_item_id + '" value=\"' + itemTitle + '\"/></div>',
					'	    <div class="span1"><button type="button" class="btn btn-block" onclick="delete_item(' + list_item_id + ');"><i class="icon-remove"></i></button></div>',
					'	</div>',
					'	<div class="reorder">',
					'		<textarea class="boxsizingBorder textarea-animated" rows="2" placeholder="Item Description (Optional)" id="item_description_' + list_item_id + '" name="item_description_' + list_item_id + '" style="width: 100%;">' + itemDescription + '</textarea>',
					'	</div>',
					'</div>',
					'<br/>',
					'<input type="hidden" id="item_type_' + list_item_id + '" name="item_type_' + list_item_id + '" value="' + itemType + '"/>',
					'</li>'
				].join('\n');
			} else if (itemType == "photos") {
				var newItem = [
					'<li id="list_item_' + list_item_id + '" class="drag_drop_list">',
					'<div class="prettyprint padding-10">',
					'  	<div class="row-fluid">',
					'  		<div class="span1"><span class="btn btn-inverse btn-block drag_drop_handle" id="item_count_' + list_item_id + '">' + list_count + '</button></div>',
					'	  	<div class="span10"><input type="text" placeholder="Item Title" class="input-block-level" id="item_title_' + list_item_id + '" name="item_title_' + list_item_id + '" value=\"' + itemTitle + '\"></div>',
					'	    <div class="span1"><button type="button" class="btn btn-block" onclick="delete_item(' + list_item_id + ');"><i class="icon-remove"></i></button></div>',
					'	</div>',
					'	<div class="row-fluid reorder">',
					'		<div class="span4" style="padding-right: 10px;"><div style="max-width: 175px;"><img src="' + imageURL + '" class="img-polaroid" id="item_image_' + list_item_id + '" name="item_image_' + list_item_id + '"/></div></div>',
					'		<div class="span8">',
					'			<div class="row-fluid">',
					'			  	<div class="span3"><form enctype="multipart/form-data" id="item_upload_form_' + list_item_id + '" name="item_upload_form_' + list_item_id + '" method="post" action="/list/forms/upload/list/item.php"><div class="fileupload fileupload-new" data-provides="fileupload"><span class="btn btn-file btn-block"><span class="fileupload-new"><i class="icon-picture"></i> Upload</span><span class="fileupload-exists"><i class="icon-picture icon-white"></i> Change</span><input class="upload" type="file" name="item_photo_upload" id="item_photo_upload" onchange="submit_item_photo(' + list_item_id + ');"/></span></div></form></div>',
					'			  	<div class="span1" style="text-align: center;"><span class="lead">or</span></div>',
					'			  	<div class="span3"><button class="btn btn-block" onclick="gif_open(' + list_item_id + ');"><i class="icon-search"></i> GIFs</button></div>',
					'			  	<div class="span1" style="text-align: center;"><span class="lead">or</span></div>',
					'			    <div class="span4"><input type="text" placeholder="Paste Link" class="input-block-level" onblur="submit_item_photo_link(' + list_item_id + ');" id="item_image_link_' + list_item_id + '" name="item_image_link_' + list_item_id + '"></div>',
					'			</div>',
					'			<div>',
					'				<textarea class="boxsizingBorder textarea-animated" rows="2" placeholder="Item Description (Optional)" id="item_description_' + list_item_id + '" name="item_description_' + list_item_id + '" style="width: 100%;">' + itemDescription + '</textarea>',
					'			</div>',
					'		</div>',
					'	</div>',
					'</div>',
					'<br/>',
					'<input type="hidden" id="item_type_' + list_item_id + '" name="item_type_' + list_item_id + '" value="' + itemType + '"/>',
					'<input type="hidden" id="item_image_file_' + list_item_id + '" name="item_image_file_' + list_item_id + '" value="' + itemImage + '"/>',
					'</li>'
				].join('\n');
			} else if (itemType == "links" || itemType == "videos" || itemType == "audios") {
				var newItem = [
					'<li id="list_item_' + list_item_id + '" class="drag_drop_list">',
					'<div class="prettyprint padding-10">',
					'  	<div class="row-fluid">',
					'  		<div class="span1"><span class="btn btn-inverse btn-block drag_drop_handle" id="item_count_' + list_item_id + '">' + list_count + '</button></div>',
					'	  	<div class="span10"><input type="text" placeholder="Item Title" class="input-block-level" id="item_title_' + list_item_id + '" name="item_title_' + list_item_id + '" value=\"' + itemTitle + '\"></div>',
					'	    <div class="span1"><button type="button" class="btn btn-block" onclick="delete_item(' + list_item_id + ');"><i class="icon-remove"></i></button></div>',
					'	</div>',
					'	<div class="reorder">',
					'		<input type="text" placeholder="Item Link" class="input-block-level" onblur="submit_item_link(' + list_item_id + ')" id="item_link_' + list_item_id + '" name="item_link_' + list_item_id + '" value="' + itemLink + '">',
					'	</div>',
					'	<div class="reorder">',
					'		<textarea class="boxsizingBorder textarea-animated" rows="2" placeholder="Item Description (Optional)" id="item_description_' + list_item_id + '" name="item_description_' + list_item_id + '" style="width: 100%;">' + itemDescription + '</textarea>',
					'	</div>',
					'	<div id="list_link_' + list_item_id + '" name="list_link_' + list_item_id + '" class="row-fluid reorder">',
					'		<div class="span4" style="padding-right: 10px;"><div style="max-width: 175px;"><img src="' + imageURL + '" class="img-polaroid" id="item_link_image_' + list_item_id + '" name="item_link_image_' + list_item_id + '"/></div></div>',
					'		<div class="span8">',
					'			<div class="padding-bottom-10">',
					'				<strong id="item_link_title_' + list_item_id + '" name="item_link_title_' + list_item_id + '">' + itemLinkTitle + '</strong>',
					'			</div>',
					'			<small>',
					'			<div class="padding-bottom-10 muted" id="item_link_description_' + list_item_id + '" name="item_link_description_' + list_item_id + '">',
					'				' + itemLinkDescription + '',
					'			</div>',
					'			</small>',
					'		</div>',
					'	</div>',
					'</div>',
					'<br/>',
					'<input type="hidden" id="item_type_' + list_item_id + '" name="item_type_' + list_item_id + '" value="' + itemType + '"/>',
					'<input type="hidden" id="item_image_file_' + list_item_id + '" name="item_image_file_' + list_item_id + '" value="' + itemImage + '"/>',
					'</li>'
				].join('\n');
			}

			// Add the item + Scroll
			$('#list_items').append(newItem);
			$('#list_body').stop().animate({
				scrollTop: $("#list_body")[0].scrollHeight
			}, 1000);
			list_items_array.push(itemID);

			// Autogrow
			$('#item_description_' + list_item_id).autosize({
				append: "\n"
			});

			// Increment the counter
			list_count++;
		});
	}

	// Submit
	function submit_update_items(action) {
		jQuery.ajaxSetup({
			async: true
		});

		var item_order_array = new Array();
		var item_title_array = new Array();
		var item_type_array = new Array();
		var item_link_array = new Array();
		var item_link_title_array = new Array();
		var item_link_description_array = new Array();
		var item_description_array = new Array();
		var item_image_array = new Array();
		var error = 0;

		// Collect all the information in an array
		$.each(list_items_array, function (key, value) {
			item_order_array[key] = key;
			item_title_array[key] = $("#item_title_" + value).val();
			item_type_array[key] = $("#item_type_" + value).val();
			item_description_array[key] = $("#item_description_" + value).val();
			if (item_type_array[key] == "text") {
				item_link_title_array[key] = "";
				item_link_description_array[key] = "";
				item_image_array[key] = "";
				item_link_array[key] = "";

				// Error checking
				if (item_title_array[key].length <= 0 && item_title_array[key].length <= 0 && action != "") {
					device_alert("You must have a title or description for all items in this list.");
					error = 1;
					return false;
				}
			} else if (item_type_array[key] == "photos") {
				item_link_title_array[key] = "";
				item_link_description_array[key] = "";
				item_image_array[key] = $("#item_image_file_" + value).val();
				item_link_array[key] = "";

				// Error checking
				if (item_image_array[key].length <= 0 && action != "") {
					device_alert("You must upload an image for all items in this list.");
					error = 1;
					return false;
				}
			} else if (item_type_array[key] == "links" || item_type_array[key] == "videos" || item_type_array[key] == "audios") {
				item_link_title_array[key] = $("#item_link_title_" + value).html();
				item_link_description_array[key] = $("#item_link_description_" + value).html();
				item_image_array[key] = $("#item_image_file_" + value).val();
				item_link = $("#item_link_" + value).val();
				item_link_array[key] = item_link;

				// Error checking
				if (item_link_title_array[key].length <= 0 && action != "" || item_link.length <= 0 && action != "" || item_link_title_array[key] == "Title of the Link" && action != "" ) {
					device_alert("You must have a proper link loaded for all link items in this list.");
					error = 1;
					return false;
				}
			}
		});

		// Check whether there are any items in the list
		if (list_items_array.length < 1 && action != "") {
			device_alert("You must have at least 1 item in a listicle.");
			error = 1;
			return false;
		}

		if (error == 0) {
			// Submit
			var submit_url = "/list/forms/list/update_items.php?username=" + username + "&userpass=" + userpass;
			$.post(submit_url, {
				'username': username,
				'listid': list_id,
				'item_orders[]': item_order_array,
				'item_titles[]': item_title_array,
				'item_types[]': item_type_array,
				'item_link_titles[]': item_link_title_array,
				'item_link_descriptions[]': item_link_description_array,
				'item_descriptions[]': item_description_array,
				'item_images[]': item_image_array,
				'item_links[]': item_link_array,
				'item_ids[]': list_items_array
			}, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					if (action == "next") {
						$('#listFirstPopup').modal('toggle');
						$('#listSecondPopup').modal('toggle');
					}
				} else if (notice.error == 1) {
					device_alert(notice.message);
				}
			});
		}
	}
	
	function copy_list_title(number)
	{
		var list_title = $('#list_title_' + number).val();
		if(number == "first")
		{
			$('#list_title_second').val(list_title);
		}
		else
		{
			$('#list_title_first').val(list_title);
		}
	}

	// Update list title
	function update_list_title(number) {
		
		// Initializations
		var list_title = $('#list_title_' + number).val();
		
		// Submit
		var submit_url = "/list/forms/list/update_list.php?username=" + username + "&userpass=" + userpass;
		$.post(submit_url, {list_id: list_id, list_title: list_title}, function (data) {
			var notice = jQuery.parseJSON(data);
			if (notice.error == 1) {
				device_alert(notice.message);
			}
		});

		// Renumber any items of the list
		renumber_items();
	}

	// Submit and publish the list
	function submit_publish_list(preview) {
		// Initializations
		update_list_title("second");
		var list_description = $("#list_description").val();
		var list_mentions = list_description.match(/@\w+/g);
		if(list_mentions != null)
		{
			for(var i = 0; i < list_mentions.length; i++) 
			{
				jQuery("#people_tags").tagsManager("pushTag", (list_mentions[i]).substring(1));
			}
		}
		$("#list_format").val($('button[name="list_format_button"].active').val());
		if(list_items_array.length <= 1)
		{
			$("#list_format").val("plain");
		}
		$("#list_design").val("list");
		$("#list_visibility").val($('button[name="list_visibility_button"].active').val());
		$("#list_social").val("");
		$('button[name="list_social_button"].active').each(function () {
			var value = $("#list_social").val();
			if (value.length <= 0) {
				$("#list_social").val(this.value);
			} else {
				$("#list_social").val(value + "," + this.value);
			}
		});
		var list_title = $('#list_title_second').val();
		if(list_title.length <= 0)
		{
			device_alert("You must enter a List Title!");
		}
		else if(loading_cover)
		{
			device_alert("Please wait while the cover photo finishes uploading!");
		}
		else
		{
			// Submit the share form
			if (share_list_check(share_list_form)) {
				if(preview != "preview" && preview != "save")
				{
					$("#publish_button").attr("disabled", "disabled");
					setTimeout(function () {
						$("#publish_button").removeAttr("disabled");
					}, 30000);
				}
				show_loading("loadshare");
				var submit_url = '/list/forms/list/share_list.php?username=' + username + "&listid=" + list_id + "&preview=" + preview +"&edit=1&userpass=" + userpass;
				$.post(submit_url, $("#share_list_form").serialize(), function (data) {
					var notice = jQuery.parseJSON(data);
					if (notice.error == 0) {
						if (preview == "preview") 
						{
							$("#preview").attr("href", "/list/user/post.php?listid=" + list_id);
							$("#preview").fancybox();
							$("#preview").click();
						} 
						else 
						{
							$('#listSecondPopup').modal('toggle');
							enable_navigation();
							location.replace("/list/user/post.php?listid=" + list_id);
						}
					} else if (notice.error == 1) {
						device_alert(notice.message);
					}
					hide_loading();
				});
			}
		}
	}
	
	function show_more_options()
	{
		$(".show_more").toggle();
	}
	
	function check_social(network)
	{
		if((network == "facebook" && facebook_connected != 1) || (network == "twitter" && twitter_connected != 1) || 
			(network == "linkedin" && linkedin_connected != 1) || (network == "tumblr" && tumblr_connected != 1))
		{
			facebook_connected = 1;
			twitter_connected = 1;
			linkedin_connected = 1;
			tumblr_connected = 1;
			$("#preview").attr("href", "/list/social.php");
			$("#preview").fancybox();
			$("#preview").click();
		}
	}
	
	function gif_open(itemid)
	{
		if(itemid != "cover")
		{
			gif_item = itemid;
			toggle_first_popup();
			$("#gifSearchPopup").modal("toggle");
		}
		else
		{
			gif_item = "cover";
			toggle_second_popup();
			$("#gifSearchPopup").modal("toggle");
		}
	}
	
	function gif_search()
	{
		gifs_array = new Array();
		var keywords = $("#gif_search").val();
		keywords = keywords.split(' ').join('+');
		if(keywords.length > 0)
		{
			$("#gif-box").show();
			$("#gif_search_button").attr("disabled", true);
			$("#gif_search_button").html("Searching...");
			$("#gif-box-left").html("");
			$("#gif-box-right").html("");
			gif_keywords = keywords;
			gif_page = 0;
			gif_left_height = 0;
			gif_right_height = 0;
			gif_search_next();
		}
	}
	
	function gif_search_next()
	{
		if(gif_loading == 0)
		{
			gif_loading = 1;
			show_loading("gif_loading");
			$.getJSON( "http://api.giphy.com/v1/gifs/search?limit=20&api_key=GMGjka4lkOTkY&q=" + gif_keywords + "&offset=" + gif_page, function(data) {
				$.each(data.data, function(key, val) 
				{
					if(gif_left_height < gif_right_height)
					{
						gif_left_height = gif_left_height + parseInt(val.images.fixed_width.height);
						$("#gif-box-left").append("<img onclick='gif_selected(\"" + val.images.original.url + "\")' class='padding-bottom-10' style='width: 100%;' src='" + val.images.fixed_width.url + "'/>");
					}
					else
					{
						gif_right_height = gif_right_height + parseInt(val.images.fixed_width.height);
						$("#gif-box-right").append("<img onclick='gif_selected(\"" + val.images.original.url + "\")' class='padding-bottom-10' style='width: 100%;' src='" + val.images.fixed_width.url + "'/>");
					}
			  	});
			    $("#gif_search_button").attr("disabled", false);
				$("#gif_search_button").html("Search");
				gif_page += 20;
				hide_loading();
				gif_loading = 0;
			});
		}
	}
	
	function gif_selected(url)
	{
		$("#gifSearchPopup").modal("toggle");
		if(gif_item != "cover")
		{
			toggle_first_popup();
			$("#item_image_link_" + gif_item).val(url);
			submit_item_photo_link(gif_item);
		}
		else
		{
			toggle_second_popup();
			$("#cover_image_link").val(url);
			submit_cover_photo_link();
		}
	}
	
	jQuery(function($) {
	    $('#gif_body').bind('scroll', function() {
	        if($(this).scrollTop() + $(this).innerHeight() >= this.scrollHeight - 100) {
	            gif_search_next();
	        }
	    })
	});
</script>
	<div id="signUpPopUp" class="modal hide fade" role="dialog" aria-labelledby="signUpText">
	<div class="modal-header centered">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3 id="signUpText" name='signUpText'>sign up, it's easier than spelling gonearea</h3>
	</div>
	<div class="modal-body" style='text-align: center;'>
		<img id="signUpImage" name='signUpImage' src='http://s3.listicle.co/production/list/storage/list/cover/display/4125871_1549716047.jpg' class='rounded' style='max-height: 375px;'/>
	</div>
	<div class="modal-footer centered" style='text-align: center;'>
		<div id="listicle_share_buttons" class="row-fluid padding-bottom-10" style="display: none;">
			<div class="span6"><a id='listicle_facebook_share' target="_blank" href='http://www.facebook.com/sharer/sharer.php' class="btn btn-block btn-facebook btn-large bold">Share on Facebook</a></div>
			<div class="span6"><a id='listicle_twitter_share' target="_blank" href='http://twitter.com/home?status=' class="btn btn-block btn-twitter btn-large bold">Share on Twitter</a></div>
		</div>
		<div>
			<div class="btn-group">
				<a class="btn btn-inverse btn-large" role="button" target="_blank" href='/list/index.php?page=signup' style=''><i class="icon-create-list"></i></a>
				<a class="btn btn-blue-create btn-large" role="button" target="_blank" href='/list/index.php?page=signup' style='width: 435px;'><strong>Sign up &amp; Share Your Own Lists on Listicle!</strong><i class="icon-white"></i></a>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	/*
	// Initializations
	var userData = getUserData();
	var username = userData.username;
	var listid = getURLParameter('listid');
	var signUp_images = new Array("http://i.imgur.com/8DUAm5V.jpg",
		"http://i.imgur.com/coSvhC4.png",
		"http://i.imgur.com/eazTOQe.jpg",
		"http://i.imgur.com/GwdoVXf.png",
		"http://i.imgur.com/GsqQkg7.jpg",
		"http://i.imgur.com/Asq3vZz.jpg",
		"http://i.imgur.com/zryWoru.jpg",
		"http://i.imgur.com/8mNaYOz.jpg",
		"http://i.imgur.com/60W10Cj.jpg",
		"http://i.imgur.com/xzchwZZ.jpg",
		"http://i.imgur.com/dKMo361.png",
		"http://i.imgur.com/POp1y1A.jpg",
		"http://i.imgur.com/zEVxwqP.jpg",
		"http://i.imgur.com/zynik9d.jpg",
		"http://i.imgur.com/FySD0Ok.jpg",
		"http://i.imgur.com/FTzAHlc.jpg",
		"http://i.imgur.com/KvOJUbF.jpg",
		"http://i.imgur.com/iuWc6t7.jpg",
		"http://i.imgur.com/iaCIjF8.png",
		"http://i.imgur.com/v2MuUL7.jpg",
		"http://i.imgur.com/EWjsSKr.jpg",
		"http://i.imgur.com/xod6wHl.jpg",
		"http://i.imgur.com/mGSUNIE.jpg",
		"http://i.imgur.com/9LcLt71.jpg"
	);
	var signUp_texts = new Array(
		"Sign up, it's easier than spelling gonearea",
		"Ooooh Stranger! Why don't you sign up",
		"I pity the fool who doesn't sign up",
		"Sign up, it's esaier tehn unisg sepllcchek",
		"Listicle's got a fever and the only prescription is more sign ups",
		"Spartans, prepare to sign up",
		"I don't always sign up but when I do...",
		"Sign up to earn 10 points for Gryffindor",
		"Sign up or Liam Neeson will find you",
		"Viewing a list without signing up? WTF",
		"Views list without signing up. Dies",
		"One doesn't simply not sign up",
		"Don't sign up. I dare u, I double dare u",
		"We're unimpressed if you don't sign up",
		"I should sign up on Listicle",
		"So I can actually make my own lists",
		"Sign ups rule everything around Listicle",
		"I signed up on Listicle. It wasn't awful",
		"And then I told him, I'll go out with you if you sign up on Listicle",
		"She didn't sign up on Listicle and now everyone's writing lists about her",
		"Hey girl, why don't you sign up on Listicle",
		"You sign up. I sign up. Remember",
		"Sign up to prove you are NOT the father",
		"Wilson! I'm sorry! I'm sorry! I'll sign up"
	);
	
	// Share buttons
	if(listid.length > 0)
	{
		var listicle_share_url = "http://listicle.co/l/" + listid;
		$("#listicle_share_buttons").show();
		$("#listicle_facebook_share").attr("href", "http://www.facebook.com/sharer/sharer.php?u=" + listicle_share_url);
		$("#listicle_twitter_share").attr("href", "http://twitter.com/home?status=" + listicle_share_url);
	}
	
	// Popup if not logged in
	if (username.length <= 0) 
	{
		setTimeout(function(){
			$('#signUpPopUp').modal('hide');
			var random = Math.floor((Math.random() * signUp_texts.length));
			$("#signUpImage").attr("src", signUp_images[random]);
			$("#signUpText").html(signUp_texts[random]);
			$('#signUpPopUp').modal('show');
		}, 10000);
	}
	*/
</script>
	<div id="container" name="container" class="container" style='display: none;'>
		<div id='facebook-like-button' style='padding-top: 28px; display: none;'>
			<div class="padding-10 rounded" style='background-color: #d7ddea; border: 1px solid #c4cde0; text-align: center;'>
				<div id="fb-root"></div>
				<script>(function(d, s, id) {
				  var js, fjs = d.getElementsByTagName(s)[0];
				  if (d.getElementById(id)) return;
				  js = d.createElement(s); js.id = id;
				  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=805103976180080&version=v2.0";
				  fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));</script>
				<span style='font-size: 12px; font-weight: bold; color: #585858;'>Get the most awesome, funny &amp; newsworthy lists delivered straight to your News Feed! &nbsp;&nbsp;</span><div class="fb-like" data-href="http://www.facebook.com/listicleco" data-width="300" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>
			</div>
		</div>
		<div class='row-fluid padding-top-10'>
			<div class="span9">
				<div id="post_cover_photo" name="post_cover_photo" class='rounded' style="background: url('/list/lib/images/backgrounds/black-wood.jpg') no-repeat center; background-size: cover; background-color: #000000;">
					<div class="image-text rounded" style="background-color:rgba(0,0,0,0.5); padding: 15px; padding-top: 0px; padding-bottom: 5px;">
						<h1 style='padding-top: 5px; font-size: 24px;' id="post_title" name="post_title"></h1> 
						<div class="padding-bottom-10"><span id='post_published' name='post_published'>Published</span> <span id="post_time_ago" name="post_time_ago"></span> &middot; <span id="post_category" name="post_category"></span> &middot; <span id="post_visibility" name="post_visibility"></span></div>
						<div class="padding-bottom-10" id="post_description" name="post_description"></div>
						<div class="row-fluid">
							<div class="span1"><div style='position: relative; height: 50px; vertical-align: middle !important;'><a class='user_link' href="#" onclick="redirectPage('profile')"><img alt='Listicle Default Profile' src="/list/lib/images/default/no-profile-display.png" id="profile_photo" name="profile_photo" class="img-polaroid rounded" style='position: relative;'/></a><span id='badge'></span></div></div>
							<div class="span10" style='padding-top: 13px;'> &nbsp; <a href="#" class="user_link image-text" onclick="redirectPage('profile')"><span class="user_fullname"></span></a> @<a href="#" class="user_link image-text" onclick="redirectPage('profile')"><span class="username"></span></a> &nbsp; <button class="btn btn-blue-notification btn-small pull-right" id='follow_unfollow_edit_button' onclick='follow_unfollow_edit();'>Edit Profile</button></div>
							<div class="span1 padding-top-10"><div onclick='flagPopup();' id='flag_link' class='cursor-pointer' style='padding-right: 8px; padding-left: 8px; border-radius: 50%; position: absolute; border: 1px solid #BDBDBD; opacity: 0.8; filter: alpha(opacity=80);'><span class='image-text lead' style='font-size: 10px;'>flag</span></div></div>
						</div>
						<div></div>
						<div class="row-fluid">
							<div class="span2" style='padding-top: 15px;'>
								<div class="btn-group btn-block" onclick='embed();'>
									<button class="btn btn-inverse">Embed</button>
									<button class="btn btn-inverse"><i class="icon-bookmark icon-white"></i></button>
								</div>
							</div>
							<div class="span2" style="padding-top: 15px; padding-left: 5px;">
								<input class='share_input' id="share_input" name="share_input" type="text" style='width: 182px; border-color: #1C1C1C !important; color: #848484 !important; background-color: #2E2E2E !important;' class="input-medium cursor-pointer" placeholder="http://www.listicle.co/" onclick="this.select();" />
							</div>
							<div class="span8">
								<div class='shareaholic-canvas' data-app='share_buttons' data-app-id='7616194'></div>
							</div>
						</div>
					</div>
				</div>
				<div id="list_container" name="list_container"></div>
				<div id="keywords_container" name="keywords_container" style="display:none;">
					<span class="lead">Keyword Tags:</span>  <span id="post_keywords" name="post_keywords"></span>
					<hr/>
				</div>
				<div class="centered">
					<div class="row-fluid">
						<div class="span3">
							<div class="btn-group btn-block">
								<button class="btn btn-inverse" style="width:30%;" id='likes_count' name='likes_count' onclick="displayLikers();">0</button>
								<button id='like_button' name='like_button' class="btn btn-blue-notification" style="width:70%;" onclick='like_post();'><i class="icon-thumbs-up icon-white"></i> Like</button>
							</div>
						</div>
						<div class="span3">
							<div class="btn-group btn-block">
								<button class="btn btn-inverse" style="width:30%;" id='relist_count' name='relist_count' onclick="displayRelisters();">0</button>
								<button id='relist_button' name='relist_button' class="btn btn-blue-notification" style="width:70%;" onclick='relist_post();'><i class="icon-retweet icon-white"></i> Relist</button>
							</div>
						</div>
						<div class="span3">
							<div class="btn-group btn-block">
								<button class="btn btn-inverse" style="width:30%;" id='favorites_count' name='favorites_count'>0</button>
								<button id='favorite_button' name='favorite_button' class="btn btn-blue-notification" style="width:70%;" onclick='favorite_post();'><i class="icon-star icon-white"></i> Bookmark</button>
							</div>
						</div>
						<div class="span3">
							<div class="btn-group btn-block">
								<button class="btn btn-inverse" style="width:30%;"><i class='icon-forward icon-arrow-right icon-white'></i></button>
								<button class="btn btn-blue-notification" style="width:70%;" onclick='next_list();'>Next List</button>
							</div>
						</div>
					</div>
				</div>
				<div style='padding: 5px;'></div>
				<div class="row-fluid">
					<div class="span2" style='padding-top: 15px;'>
						<div class="btn-group btn-block" onclick='embed();'>
							<button class="btn btn-inverse">Embed</button>
							<button class="btn btn-inverse"><i class="icon-tag icon-white"></i></button>
						</div>
					</div>
					<div class="span2" style="padding-top: 15px; padding-left: 5px;">
						<input class='share_input' style='width: 152px;' id="share_input" name="share_input" type="text" class="input-small" placeholder="http://www.listicle.co/" onclick="this.select();" />
					</div>
					<div class="span8 padding-bottom-10">
						<div class='shareaholic-canvas' data-app='share_buttons' data-app-id='6598644'></div>
					</div>
				</div>
				<div id="list_related_lists_box" name="list_related_lists_box">
				</div>
				<div class='list_related_padding' style='padding: 5px;'></div>
				<div class='prettyprint padding-10'>
					<div class="row-fluid">
						<div class="span1">
							<img alt='Listicle Default Profile Thumbnail' src="/list/lib/images/default/no-profile-thumbnail-large.png" class="img-polaroid rounded" id='comment_photo' name='comment_photo' style='height: 38px;' />
						</div>
						<div class="span9">
							<form id='update_comments_form' name='update_comments_form' method="post" action='javascript:void(0)'>
								<div class='rounded padding-5' contenteditable="true" id="comment_div" name="comment_div" style="width: 100%; background-color: #FFFFFF; height: 38px; border: 1px solid #BDBDBD; overflow: auto;"></div>
								<textarea style='display: none;' id="comment_box" name="comment_box"></textarea>
								<input id='comment_reply_to' name='comment_reply_to' type='hidden' value=''/>
								<input id='comment_root' name='comment_root' type='hidden' value=''/>
							</form>
						</div>
						<div class="span2 padding-left-10" style='padding-top: 4px;'>
							<button class="btn btn-block btn-large btn-blue-notification" id='comment_button' name='comment_button' onclick="comment_post();" style='font-size: 16px;'>Comment</button>
						</div>
					</div>
				</div>
				<div id="likersPopup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="likersPopupLabel" aria-hidden="true">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
						<h3 id="likersPopupLabel">People Who Liked This List</h3>
					</div>
					<div class="modal-body">
						<div id='likers_box' name='likers_box'></div>
						<button class='btn btn-block btn-blue-notification btn-large' id='show_more_likers_button' name='show_more_likers_button' onclick="displayLikers();">Show More</button>
					</div>
					<div class="modal-footer">
						<button data-dismiss="modal" aria-hidden="true" class="btn" style='width: 100px;'>Okay</button>
					</div>
				</div>
				<div id="relistersPopup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="relistersPopupLabel" aria-hidden="true">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
						<h3 id="likersPopupLabel">People Who Relisted This List</h3>
					</div>
					<div class="modal-body">
						<div id='relisters_box' name='relisters_box'></div>
						<button class='btn btn-block btn-blue-notification btn-large' id='show_more_relisters_button' name='show_more_relisters_button' onclick="displayRelisters();">Show More</button>
					</div>
					<div class="modal-footer">
						<button data-dismiss="modal" aria-hidden="true" class="btn" style='width: 100px;'>Okay</button>
					</div>
				</div>
				<div id="commentLikersPopup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="commentLikersLabel" aria-hidden="true">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
						<h3 id="commentLikersLabel">People Who Liked This Comment</h3>
					</div>
					<div class="modal-body">
						<div id='comment_likers_box' name='comment_likers_box'></div>
					</div>
					<div class="modal-footer">
						<button data-dismiss="modal" aria-hidden="true" class="btn" style='width: 100px;'>Okay</button>
					</div>
				</div>
				<div id="commentRepliesPopup" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="commentRepliesLabel" aria-hidden="true">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
						<h3 id="commentRepliesLabel">People Who Replied To This Comment</h3>
					</div>
					<div class="modal-body">
						<div id='comment_replies_box' name='comment_replies_box'></div>
					</div>
					<div class="modal-footer">
						<button data-dismiss="modal" aria-hidden="true" class="btn btn-success" style='width: 100px;'>Okay</button>
					</div>
				</div>
				<br/>
				<div class="centered" id="comments" name="comments" style='text-align: left;'></div>
				<button class='btn btn-block btn-blue-notification btn-large' id='show_more_comments_button' name='show_more_comments_button' onclick="displayComments();">Show More</button>
			</div>
			<div class="span3">
				<div class="centered">
					<div class="btn-group" data-toggle="buttons-radio" style="width: 100%; padding-top: 10px;">
						<button name="list_design_button" id='design_button_list' rel="tooltip" title="View as List" type="button" class="btn" style='width: 50%;' value='list' onclick="displayList('list');"><i class="icon-th-list"></i>
						</button>
						<button name="list_design_button" id='design_button_grid' rel="tooltip" title="View as Grid" type="button" class="btn" style='width: 50%;' value='grid' onclick="displayList('grid');"><i class="icon-th-large"></i>
						</button>
					</div>
				</div>
				<div class="row-fluid padding-top-10 centered" id="user_related_buttons" name="user_related_buttons" style="display: none;">
					<div class='span6'>
						<button class="btn btn-inverse btn-block" role="button" data-toggle="modal" href="#listFirstPopup" onclick="update_list()">Edit</button>
					</div>
					<div class='span6'>
						<button class="btn btn-blue-notification btn-block" role="button" data-toggle="modal" href="#deleteListPopup">Delete</button>
					</div>
				</div>
				<div class="padding-top-10" id="user_related_lists" name="user_related_lists">
					<div class="prettyprint" style="padding: 5px; padding-top: 0px;">
						<div id="user_related_lists_title" class="text-error" style='padding-left: 1px; padding-right: 1px; border-bottom: 1px solid #E0E0E0;'><h4>More Lists by <span id='related_firstname' name='related_firstname'></span></h4></div>
						<div id="user_related_lists_box" name="user_related_lists_box"></div>
					</div>
				</div>
				</div>
			</div>
		</div>
	</div>
	<div id="deleteListPopup" class="modal hide fade" tabindex="-1" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="deleteListLabel">
		<div class="modal-header">
			<h3 id="deleteListLabel">Delete this List</h3>
		</div>
		<div class="modal-body">
			Are you sure you want to delete this list?
		</div>
		<div class="modal-footer">
			<div>
				<a class="btn" type="button" data-dismiss="modal" style='width: 80px;'>Cancel</a>
				<a class="btn btn-danger" style='width: 80px;' onclick='delete_list();'>Delete</a>
			</div>
		</div>
	</div>
	<div id="deleteCommentPopup" class="modal hide fade" tabindex="-1" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="deleteCommentLabel">
		<div class="modal-header">
			<h3 id="deleteCommentLabel">Delete this Comment</h3>
		</div>
		<div class="modal-body">
			Are you sure you want to delete this comment?
		</div>
		<div class="modal-footer">
			<div>
				<a class="btn" type="button" data-dismiss="modal" style='width: 80px;'>Cancel</a>
				<a class="btn btn-danger" data-dismiss="modal" style='width: 80px;' onclick='delete_comment();'>Delete</a>
			</div>
		</div>
	</div>
	<div id="embedPopup" class="modal hide fade" role="dialog" aria-labelledby="embedLabel">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			<h3 id="embedLabel">Embed this Listicle</h3>
		</div>
		<div class="modal-body">
			<h5>For Websites, please place the following HTML code wherever you want the embedded listicle to appear:</h5>
			<textarea class="boxsizingBorder textarea-animated" rows="2" placeholder="Embed Code for Websites" id="embed_website" name="embed_website" style="width: 100%;" onclick="this.select()"></textarea>
			<h5>For WordPress Websites &amp; Blogs, please install the <a href='http://listicle.co/l/16261' target='_blank'>Listicle plugin</a> first and then place the following shortcode in your WordPress post:</h5>
			<textarea class="boxsizingBorder textarea-animated" rows="1" placeholder="Embed Code for Wordpress" id="embed_wordpress" name="embed_wordpress" style="width: 100%;" onclick="this.select()"></textarea>
		</div>
		<div class="modal-footer">
			<div>
				<a class="btn btn-inverse" type="button" data-dismiss="modal" style='width: 80px;'>Okay</a>
			</div>
		</div>
	</div>
	<div id="video-modal" class="modal hide " tabindex="-1" role="dialog" style="width: 680px; margin-left: -340px; height: 450px; text-align: center; background-color: transparent; border-color: transparent; box-shadow: none;">
	</div>
	<div id="video-item-modal" class="modal hide " tabindex="-1" role="dialog" style="width: 680px; margin-left: -340px; height: 450px; text-align: center; background-color: transparent; border-color: transparent; box-shadow: none;">
	</div>
	<a class="fancybox fancybox.iframe" id='preview' name='preview' style='display: none;'></a>
	<div id="flagPopup" class="modal hide fade" tabindex="-1" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="flagPopupLabel">
		<div class="modal-header">
			<h3 id="flagPopupLabel">Flag this List</h3>
		</div>
		<div class="modal-body">
			Are you sure you want to flag this list as inappropriate or offensive?
		</div>
		<div class="modal-footer">
			<div>
				<a class="btn" type="button" data-dismiss="modal" style='width: 80px;'>Cancel</a>
				<a class="btn btn-danger" data-dismiss="modal" style='width: 80px;' onclick='flag_list();'>Flag</a>
			</div>
		</div>
	</div>
	<div id="flagCommentPopup" class="modal hide fade" tabindex="-1" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="flagCommentPopupLabel">
		<div class="modal-header">
			<h3 id="flagCommentPopupLabel">Flag this Comment</h3>
		</div>
		<div class="modal-body">
			Are you sure you want to flag this comment as inappropriate or offensive?
		</div>
		<div class="modal-footer">
			<div>
				<a class="btn" type="button" data-dismiss="modal" style='width: 80px;'>Cancel</a>
				<a class="btn btn-danger" data-dismiss="modal" style='width: 80px;' onclick='flag_comment();'>Flag</a>
			</div>
		</div>
	</div>
	<div class="container" style='padding-bottom: 20px;'>
	<hr style='border: 0px; height: 0px; border-top: 1px solid rgba(0, 0, 0, 0.1); border-bottom: 1px solid rgba(255, 255, 255, 0.3);'/>
	<footer>
		<div class="pull-left muted">
			<a href="http://polarhills.com/">Polar Hills &copy; <span id="today"></span></a> &middot; All rights reserved &middot; 
			<a target='_blank' href='http://www.twitter.com/listicleco'><img src='/list/lib/images/social/twitter.png' style='opacity: 0.5; height: 14px; width: 14px;'/></a> 
		</div>
		<div class="pull-right muted">
			<a href='/list/about.php'>About</a>
			&nbsp;&middot;&nbsp;
			<a href='/list/team.php'>Team</a>
			&nbsp;&middot;&nbsp;
			<a href='/list/terms.php'>Terms</a>
			&nbsp;&middot;&nbsp;
			<a href='/list/policy.php'>Policy</a>
			&nbsp;&middot;&nbsp;
			<a href='/list/lists.php'>Lists</a>
		</div>
	</footer>
</div>
<div id='errorPopup' name='errorPopup'></div>
<div id='successPopup' name='successPopup'></div>

<script type="text/javascript">
	
	// Enable tooltips
	$("#today").html(new Date().getFullYear());
	var is_touch_device = 'ontouchstart' in document.documentElement;
	if (!is_touch_device) 
	{
		$("[rel=tooltip]").tooltip({ placement: 'bottom'});
	}
</script>	<script type="text/javascript">
		
		// Initializations
		var ads = 0;
		var edit_follow_unfollow = "edit";
		var currentUserData = getUserData();
		var username = currentUserData.username;
		var userpass = currentUserData.userpass;
		var birthyear = parseInt(currentUserData.birthyear);
		var currentUserProfile = "";
		var userphoto = "";
		var fullname = "";
		var invitations_left = 0;
		if (username.length > 0) {
			currentUserProfile = getUserProfile(username);
			userphoto = currentUserProfile.profile_photo;
			userbadge = currentUserProfile.badge;
			fullname = currentUserProfile.firstname + " " + currentUserProfile.lastname;
			invitations_left = currentUserProfile.invitations_left;
			ads = 0; // Disable ads for signed in users
		}
		else
		{
			// $("#facebook-like-button").show();
		}
		var listid = getURLParameter('listid').replace("<", "").replace(">", "");
		var forcedesign = getURLParameter('design').replace("<", "").replace(">", "");
		var list_title = "";
		var listFormat = "plain";
		var listDesign = "list";
		if(forcedesign.length > 0)
		{
			listDesign = forcedesign;
		}
		var listCategory = "general";
		var listPublished = 1;
		var listVisibility = 1;
		var commentsPage = 1;
		var likersPage = 1;
		var relistersPage = 1;
		var jsonList = {};
		var loading = false;
		var commentid = 0;
		var totalItems = 0;
		var comment_root = "";
		var current_url = encodeURIComponent(window.location.href);
		var invitationsPopup = 0;
		var listTags = [];
		var flagCommentID = "";
		
		// Invitation Popup
		setTimeout(function(){
			invitationsPopup = 1;
			if(commentsPage == -1)
			{
				if(username.length <= 0)
				{
					toggle_request_invite();
				}
				invitationsPopup = 0;
			}
		}, 20000);

		// Function to open the flagging popup
		function flagPopup()
		{
			$("#flagPopup").modal('toggle');
		}
		
		// Function to flag/report a user
		function flag_list()
		{
			var submit_url = '/list/forms/list/flag.php?username=' + username + "&userpass=" + userpass + "&listid=" + listid;
			$.post(submit_url, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					device_success(notice.message);
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
			});
		}
		
		// Delete a list
		function delete_list()
		{
			$.post("/list/forms/list/delete_list.php?userpass=" + userpass, { username: username, listid: listid }, function( data ) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					window.location = "/list/user/index.php";
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
			});
		}
		
		// Delete a list
		function delete_comment()
		{
			$.post("/list/forms/list/delete_comments.php?userpass=" + userpass, { username: username, listid: listid, commentid: commentid, comment_root: comment_root }, function( data ) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					refreshComments();
					comment_root = '';
					commentid = '';
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
			});
		}
		
		// Confirm Delete a list
		function confirm_delete_comment(id, root)
		{
			comment_root = root;
			commentid = id;
			$("#deleteCommentPopup").modal('toggle')
		}

		// Function to follow/unfollow/edit profile
		function follow_unfollow_edit() {
			// Error check
			if (username.length <= 0) {
				open_tab("/list/index.php?page=signup&redirect=" + current_url);
				return false;
			}

			if (edit_follow_unfollow == "edit") {
				window.location = "/list/user/settings.php";
			} else if (edit_follow_unfollow == "follow") {
				$.post("/list/forms/user/update_relationship.php?userpass=" + userpass, {
					follower: username,
					following: profileUsername,
					follow_unfollow: "follow"
				});
				$("#follow_unfollow_edit_button").attr("class", "btn btn-small btn-danger");
				$("#follow_unfollow_edit_button").html("Unfollow");
				edit_follow_unfollow = "unfollow";
			} else if (edit_follow_unfollow == "unfollow") {
				$.post("/list/forms/user/update_relationship.php?userpass=" + userpass, {
					follower: username,
					following: profileUsername,
					follow_unfollow: "unfollow"
				});
				$("#follow_unfollow_edit_button").attr("class", "btn btn-small btn-success");
				$("#follow_unfollow_edit_button").html("Follow");
				edit_follow_unfollow = "follow";
			}
		}

		function redirectPage(pageAddress) {
			window.location = "/list/user/" + pageAddress + ".php?username=" + profileUsername;
		}

		 // Gets the list
		function getList() {
			jQuery.ajaxSetup({
				async: false
			});
			var get_list_url = "/list/get/list/list.php?id=" + listid;
			$.get(get_list_url, function (data) {
				jsonList = jQuery.parseJSON(data);
				totalItems = jsonList.items.length;
			});
			jQuery.ajaxSetup({
				async: true
			});
		}
		
		// Display user related lists
		function display_user_related_lists()
		{
			var get_list_url = "/list/get/user/related_lists.php?listid=" + listid + "&username=" + profileUsername;
			$.get(get_list_url, function (data) {
				var json = jQuery.parseJSON(data);
				var count = 0;
				$.each(json, function (key, value) {
					var title = value.title;
					var cover_photo = amazon_get_file("/list/storage/list/cover/thumbnail/" + value.cover_photo);
					var link = "/list/user/post.php?listid=" + value.listid;
					if(value.cover_photo.length > 0)
					{
						$("#user_related_lists_box").append(
							"<div style='padding-top: 5px; text-align: center;'><a href='" + link + "'><img src='" + cover_photo + "' class='prettyprint'></a></div>" + 
							"<div style='padding-top: 5px; padding-bottom: 5px; padding-left: 1px; border-bottom: 1px dotted #E0E0E0;'><strong><a href='" + link + "'>" + title + "</a></strong></div>"
						)
						count++;
					}
				});
				if(count == 0)
				{
					$("#user_related_lists_title").hide();
					var get_list_url = "/list/get/list/related_lists.php?listid=" + listid + "&username=" + profileUsername;
					$.get(get_list_url, function (data) {
						var json = jQuery.parseJSON(data);
						var count = 0;
						$.each(json, function (key, value) {
							var title = value.title;
							var cover_photo = amazon_get_file("/list/storage/list/cover/thumbnail/" + value.cover_photo);
							var link = "/list/user/post.php?listid=" + value.listid;
							if(value.cover_photo.length > 0 && count <= 3)
							{
								$("#user_related_lists_box").append(
									"<div style='padding-top: 5px; text-align: center;'><a href='" + link + "'><img src='" + cover_photo + "' class='prettyprint'></a></div>" + 
									"<div style='padding-top: 5px; padding-bottom: 5px; padding-left: 1px; border-bottom: 1px dotted #E0E0E0;'><strong><a href='" + link + "'>" + title + "</a></strong></div>"
								)
								count++;
							}
						});
						if(count == 0)
						{
							$("#user_related_lists").hide();
						}
					});
				}
			});
		}
		
		// Display list related lists
		function display_list_related_lists()
		{
			var get_list_url = "/list/get/list/related_lists.php?listid=" + listid + "&username=" + profileUsername;
			$.get(get_list_url, function (data) {
				var json = jQuery.parseJSON(data);
				var count = 0;
				$.each(json, function (key, value) {
					var title = value.title;
					var cover_photo = amazon_get_file("/list/storage/list/cover/thumbnail/" + value.cover_photo);
					var link = "/list/user/post.php?listid=" + value.listid;
					if(value.cover_photo.length > 0 && value.listid != listid && title.length > 0)
					{
						$("#list_related_lists_box").append(
							"<div class='slide prettyprint'>" + 
							"	<a href='" + link + "'>" + 
							"		<img src='" + cover_photo + "'> " + 
							"		<div class='padding-5 ellipsis bold'>" + title + "</div>" + 
							"	</a>" + 
							"</div>"
						)
						count++;
					}
				});
				if(count < 3)
				{
					$("#list_related_lists_box").hide();
					$("#list_related_padding").hide();
				}
				else
				{
					$('#list_related_lists_box').bxSlider({
						slideWidth: 225,
					    minSlides: 3,
					    maxSlides: 3,
					    slideMargin: 3,
					    pager: false
					});
				}
			});
		}

		// Display the list and it's containers
		function displayList(design) {
			
			// If not loaded yet, load it
			if (jQuery.isEmptyObject(jsonList)) {
				getList();
				design = "list";
				if(jsonList.format == "rankable" || jsonList.items_count >= 30)
				{
					design = "grid";
				}
				if(forcedesign.length > 0)
				{
					design = forcedesign;
				}
			}

			// Get the list information
			var json = jsonList;
			profileUsername = json.username;
			listVisibility = json.visibility;
			
			// Tags
			var tags = json.tags;
			var tags_array = tags.split(',');
			listTags = tags_array;
			listTags.push(profileUsername);

			// Display the proper list visibility
			if (listVisibility == "public") {
				$("#post_visibility").html("<i class='icon-white icon-globe'></i>");
			} else {
				$("#post_visibility").html("<i class='icon-white icon-lock'></i>");
				$("#post_published").html("Edited")

				// Visible to specific people
				if ((username != profileUsername) && ($.inArray(username, tags_array) == -1 || tags.length <= 0)) {
					open_tab("/list/index.php");
				}
			}

			// User data
			userProfile = getUserProfileAsync(profileUsername);

			// Photo
			userProfilePhoto = userProfile.profile_photo;
			userCoverPhoto = userProfile.cover_photo;
			
			// Profile of the list-maker
			$(".user_link").webuiPopover({type:'iframe', url:'/list/embed/profile.php?username=' + profileUsername, width: 400, height: 145, padding: false, trigger: 'hover', delay: {show: 1000, hide: null}});

			// If profile picture exists, show it
			if (userProfilePhoto != "") {
				var file = amazon_get_file("/list/storage/user/profile/display/" + userProfilePhoto);
				$("#profile_photo").attr("src", file);
			}

			// If cover picture exists, show it
			if (userCoverPhoto != "") {
				var file = amazon_get_file("/list/storage/user/cover/display/" + userCoverPhoto);
				$('#cover_photo').css("background-image", "url(\"" + file + "\")");
			}
			
			// Badge
			var badge = userProfile.badge;
			var badge_html = get_badge("post", badge);
			$("#badge").replaceWith(badge_html);

			// Get user stats + follow/unfollow/edit button
			var userListsCount = userProfile.lists_count;
			var userFollowerCount = userProfile.follower_count;
			var userFollowingCount = userProfile.following_count;
			$("#lists_count").html(userListsCount + "<br/> Lists");
			$("#follower_count").html(userFollowerCount + "<br/> Followers");
			$("#following_count").html(userFollowingCount + "<br/> Following");

			// Follow/unfollow/edit button
			var relationship = false;

			// Same user
			if (username == profileUsername) {
				$("#follow_unfollow_edit_button").attr("class", "btn btn-small btn-blue-notification");
				$("#follow_unfollow_edit_button").html("Edit Profile");
				edit_follow_unfollow = "edit";

				// Edit Post Button
				$("#user_related_buttons").show();
				$("#edit_post_button").show();
				$("#delete_post_button").show();
				$("#flag_link").hide();
			} else {
				var relationship = getUserRelationship(username, profileUsername);

				// Following
				if (relationship == true) {
					$("#follow_unfollow_edit_button").attr("class", "btn btn-small btn-danger");
					$("#follow_unfollow_edit_button").html("Unfollow");
					edit_follow_unfollow = "unfollow";
				}

				// Unfollowing
				else {
					$("#follow_unfollow_edit_button").attr("class", "btn btn-small btn-success");
					$("#follow_unfollow_edit_button").html("Follow");
					edit_follow_unfollow = "follow";
				}
			}

			// Fill in the values
			$(".user_fullname").html(userProfile.firstname + " " + userProfile.lastname);
			$("#related_firstname").html(userProfile.firstname);
			$(".username").html(userProfile.username);
			
			// Re-enable tooltips
			var is_touch_device = 'ontouchstart' in document.documentElement;
			if (!is_touch_device) 
			{
				$("[rel=tooltip]").tooltip({ placement: 'bottom'});
			}

			// Initialization
			listFormat = json.format;
			listCategory = json.category;
			listDesign = json.design;
			listPublished = json.published;
			list_title = json.title;
			$("#post_title").html(json.title);
			$("#post_description").html(json.description);
			$("#post_time_ago").html(json.time_ago);
			$("#post_category").html("<a class='image-text' href='/list/user/topic.php?category=" + json.category + "'>" + json.category_name + "</a>");
			if(design.length > 0)
			{
				listDesign = design;
			}
			
			var coverphoto = "http://www.listicle.co/list/lib/images/backgrounds/black-wood.jpg";
			if (json.cover_photo.length > 0) 
			{
				coverphoto = amazon_get_file("/list/storage/list/cover/display/" + json.cover_photo);
			}
			$('#post_cover_photo').css("background", 'url(' + coverphoto + ') center');
			$('#post_cover_photo').css("background-size", 'cover');

			// Add the tags
			var keywords_html = "";
			var keywords_array = json.keywords.trim().split(',');
			for (var i = 0; i < keywords_array.length; i++) {
				keywords_html += "<a class='lead' href='/list/search.php?type=lists&query=" + keywords_array[i] + "'>" + keywords_array[i] + "</a>";
				if (i < (keywords_array.length - 1)) {
					keywords_html += ", ";
				}
			}

			if (json.keywords.trim().length > 0) {
				$("#post_keywords").html(keywords_html);
				$("#keywords_container").show();
			}

			// Get the proper design
			if (design.length <= 0 && listDesign.length > 0) {
				design = listDesign;
			} else if (design.length <= 0) {
				design = "list";
			}
			listDesign = design;
			$('#design_button_' + design).button('toggle');

			// If no list selected, redirect to home
			if (json.title.length <= 0) {
				window.location.href = "/list/index.php";
			}

			// Set the counts
			$("#likes_count").html(json.likes_count);
			$("#relist_count").html(json.relist_count);
			$("#favorites_count").html(json.favorites_count);

			// Set the main list containers
			if (design == "list") {
				// Initialize
				$("#navButtons").html("");
				$("#list_container").html("<div id='list_list' name='list_list' class='padding-top-10'></div>");

				// Adding the items
				displayListItems(json.items);
			} else if (design == "grid") {
				// Initialize
				$("#navButtons").html("");
				$("#list_container").html("<div id='list_grid' name='list_grid' class='padding-top-10 padding-bottom-10'></div>");

				// Adding the items
				displayListItems(json.items);
			}
		}

		 // Display the list items
		function displayListItems(items) {
			
			// Get the list information
			var json = items;

			// Counter
			var counter = 1;

			$.each(json, function (index) {

				// Initialization
				var itemID = json[index].id;
				var itemTitle = json[index].title;
				var itemType = json[index].type;
				var itemDescription = json[index].description;
				var itemImage = json[index].image;
				var itemLinkTitle = json[index].link_title;
				var itemLinkDescription = json[index].link_description;
				var itemLink = json[index].link;
				var itemVideo = json[index].video;
				var itemRankCount = json[index].rank_count;
				var itemChecked = json[index].checked;
				var width = json[index].width;
				var height = json[index].height;
				var itemOpenLink = "";
				var counterHTML = "";
				var itemLinkHTML = "";
				var imageURL = "";
				var imageGridURL = "";
				var playHTML = "";
				var itemLinkTextHTML = "";
				if(itemLinkTitle.toLowerCase() != itemLink.toLowerCase() && itemLinkTitle.length > 0)
				{
					itemLinkTextHTML += "<div class='bold' style='font-size: 14px;'>" + itemLinkTitle + "</div>";
				}
				if(itemLinkDescription.toLowerCase() != itemLink.toLowerCase() && itemLinkDescription.length > 0)
				{
					itemLinkTextHTML += "<div style='font-size: 12px; color: #585858'>" + itemLinkDescription + "</div>";
				}

				// If the title or description is not given for a link, show the link's info
				if (itemTitle.length <= 0 && itemLinkTitle.length <= 0 && listDesign != "list") {
					itemTitle = "&nbsp;";
				}

				// Non-empty image
				if (itemImage.length > 0) {
					imageURL = amazon_get_file("/list/storage/list/item/display/" + itemImage);
					imageGridURL = amazon_get_file("/list/storage/list/item/thumbnail/" + itemImage);
				}

				// Counter
				if (listFormat == "numbered" || listFormat == "countdown") {
					counterHTML = counter + ". ";
				}

				// Open link in new tab
				if (itemLink.length > 0 && itemType != "videos") {
					itemOpenLink = "open_new_tab(\"" + itemLink + "\")";
					itemLinkHTML = "<div class='bold'>Source: <a onclick='event.stopPropagation();' href='" + itemLink + "'>" + getHost(itemLink) + "</a></div>";
				}

				// Add the items
				if (listDesign == "list") {
					// Play icon
					if ((itemType == "audios" || itemType == "videos") && itemVideo.length <= 0 && itemImage.length > 0) 
					{
						playHTML = "<a target='_blank' onclick='event.stopPropagation();' href='" + itemLink + "'><img src='/list/lib/images/overlays/play.png' style='margin: auto; top: 0; left: 0; bottom: 0; right: 0; position: absolute; opacity:0.5; filter: alpha(opacity=50);'/></a>";
					}
					else if(itemType == "videos" && itemVideo.length > 0&& itemImage.length > 0)
					{
						playHTML = "<a target='_blank' onclick='event.stopPropagation(); playVideo(\"" + itemVideo + "\", \"" + width + "\", \"" + height + "\");'><img src='/list/lib/images/overlays/play.png' style='margin: auto; top: 0; left: 0; bottom: 0; right: 0; position: absolute; opacity:0.5; filter: alpha(opacity=50);'/></a>";
					}
					
					// Checklist
					if(listFormat == "checklist")
					{
						if(itemChecked == 0)
						{
							counterHTML = "<img onclick='event.stopPropagation(); check_uncheck(\"" + itemID + "\", \"list\");' id='checkbox_" + itemID + "' name='checkbox_" + itemID + "' src='/list/lib/images/glyphicons/unchecked_checkbox.png' style='width: 17px; height: 17px; vertical-align: middle; padding-bottom: 3px;'/> ";
						}
						else
						{
							counterHTML = "<img onclick='event.stopPropagation(); check_uncheck(\"" + itemID + "\", \"list\");' id='checkbox_" + itemID + "' name='checkbox_" + itemID + "' src='/list/lib/images/glyphicons/checked_checkbox.png' style='width: 17px; height: 17px; vertical-align: middle; padding-bottom: 3px;'/> ";
						}
					}

					// Title
					var titleString = counterHTML + itemTitle;
					var titleHTML = "<h4 class='padding-bottom-10'>" + titleString + "</h4>";
					if (titleString.length <= 0) {
						titleHTML = "";
					}

					// Image
					var background_color = "transparent";
					if(width > 700 || height < width)
					{
						height = Math.round(height * (700 / width));
						width = 700;
					}
					if(height > 475)
					{
						height = 475;
						width = Math.round(width * (700 / height));
						background_color = "#000000";
					}
					if(width < 700)
					{
						background_color = "#000000";
					}
					var imageHTML = "<div onclick='" + itemOpenLink + "' class='padding-bottom-10'><div class='rounded' style='cursor: pointer !important; background: url(" + imageURL + ") no-repeat center; height: " + height + "px; background-size: contain; background-color: " + background_color + "; position: relative;'>" + playHTML + "</div></div>";
					if (itemImage.length <= 0) {
						imageHTML = "";
					}

					// Description
					var descriptionHTML = "<div class=''>" + itemDescription + "</div>";
					if (itemDescription.length <= 0) {
						descriptionHTML = "";
					}
					
					// Upvote Button
					var upvoteButton = 	"";
					if(listFormat == "rankable")
					{
						upvoteButton = 	"<div class='btn-group' style='float: right;' onclick='event.stopPropagation();'>" + 
										"	<button id='upvote_count_" + itemID + "' name='upvote_count_" + itemID + "' class='btn btn-inverse btn-small' style='min-width: 40px;'>" + itemRankCount + "</button>" + 
										"	<button id='upvote_button_" + itemID + "' name='upvote_button_" + itemID + "' class='btn btn-blue-notification btn-small' style='min-width: 40px;' onclick='upvote(" + itemID + ")'><i class='icon-arrow-up icon-white'></i></button>" + 
										"</div>";
					}

					// HTML
					if (itemLink.length > 0) 
					{
						if(itemImage.length <= 0)
						{
							height = 0;
						}
						var itemLinkHTML = "<div class='padding-5' style='font-size: 12px;'>" + itemLinkTextHTML + " <span class='muted'>Source: <a target='_blank' class='muted bold' onclick='event.stopPropagation();' href='" + itemLink + "'>" + getHost(itemLink) + "</a></span></div>";
						var linkHTML = "<div onclick='" + itemOpenLink + "' class='padding-bottom-10 cursor-pointer'><div class='prettyprint'><div class='rounded-top' style='cursor: pointer !important; background: url(" + imageURL + ") no-repeat center; height: " + height + "px; background-size: contain; background-color: " + background_color + "; position: relative;'>" + playHTML + "</div> " + itemLinkHTML + "</div></div>";
						var item_html =
							"<div style='width: 100%;' id='item_" + counter + "' name='item_" + counter + "'>" +
							upvoteButton +
							titleHTML + 
							linkHTML +
							descriptionHTML +
							"</div> <hr/>";
					}
					else
					{
						var item_html =
							"<div style='width: 100%;' id='item_" + counter + "' name='item_" + counter + "'>" +
							upvoteButton +
							titleHTML + 
							imageHTML +
							descriptionHTML +
							itemLinkHTML +
							"</div> <hr/>";
					}
				
					if (listFormat == "countdown") {
						if((index + 1) % 3 == 0 && index > 0 && ads == 1)
						{
							$("#list_list").prepend("<script async src=\"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"><\/script><!-- list --><ins class=\"adsbygoogle\"     style=\"display:block\"     data-ad-client=\"ca-pub-2294122083808392\"     data-ad-slot=\"4051055460\"     data-ad-format=\"auto\"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script><hr\/>");
						}
						if(totalItems == 1 && ads == 1)
						{
							$("#list_list").prepend("<script async src=\"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"><\/script><!-- list --><ins class=\"adsbygoogle\"     style=\"display:block\"     data-ad-client=\"ca-pub-2294122083808392\"     data-ad-slot=\"4051055460\"     data-ad-format=\"auto\"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script><br\/>");
						}
						$("#list_list").prepend($(item_html));
					} else {
						$("#list_list").append($(item_html));
						if(totalItems == 1 && ads == 1)
						{
							$("#list_list").append("<script async src=\"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"><\/script><!-- list --><ins class=\"adsbygoogle\"     style=\"display:block\"     data-ad-client=\"ca-pub-2294122083808392\"     data-ad-slot=\"4051055460\"     data-ad-format=\"auto\"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script><br\/>");
						}
						if((index + 1) % 3 == 0 && index > 0 && ads == 1)
						{
							$("#list_list").append("<script async src=\"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"><\/script><!-- list --><ins class=\"adsbygoogle\"     style=\"display:block\"     data-ad-client=\"ca-pub-2294122083808392\"     data-ad-slot=\"4051055460\"     data-ad-format=\"auto\"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script><hr\/>");
						}
					}
				} else if (listDesign == "grid") {
					// Play icon
					if ((itemType == "audios" || itemType == "videos") && itemVideo.length <= 0) 
					{
						playHTML = "<a target='_blank' onclick='event.stopPropagation();' href='" + itemLink + "'><img src='/list/lib/images/overlays/play.png' style='margin: auto; top: 0; left: 0; bottom: 0; right: 0; position: absolute; opacity:0.5; filter: alpha(opacity=50); width: 100px; height: 100px;'/></a>";
					}
					else if(itemType == "videos" && itemVideo.length > 0)
					{
						playHTML = "<a target='_blank' onclick='event.stopPropagation(); playVideo(\"" + itemVideo + "\", \"" + width + "\", \"" + height + "\");'><img src='/list/lib/images/overlays/play.png' style='margin: auto; top: 0; left: 0; bottom: 0; right: 0; position: absolute; opacity:0.5; filter: alpha(opacity=50); width: 100px; height: 100px;'/></a>";
					}

					if (itemTitle.length <= 0) {
						itemTitle = "&nbsp;";
					}
					
					// Checklist
					if(listFormat == "checklist")
					{
						if(itemChecked == 0)
						{
							counterHTML = "<img onclick='event.stopPropagation(); check_uncheck(\"" + itemID + "\", \"grid\");' id='checkbox_" + itemID + "' name='checkbox_" + itemID + "' src='/list/lib/images/glyphicons/unchecked_checkbox_white.png' style='width: 17px; height: 17px; vertical-align: middle; padding-bottom: 4px;'/> ";
						}
						else
						{
							counterHTML = "<img onclick='event.stopPropagation(); check_uncheck(\"" + itemID + "\", \"grid\");' id='checkbox_" + itemID + "' name='checkbox_" + itemID + "' src='/list/lib/images/glyphicons/checked_checkbox_white.png' style='width: 17px; height: 17px; vertical-align: middle; padding-bottom: 4px;'/> ";
						}
					}
					
					// Upvote Button
					var upvoteButton = 	"";
					if(listFormat == "rankable")
					{
						upvoteButton = 	"<div class='btn-group' style='float: right; padding: 7px; z-index: 1000;' onclick='event.stopPropagation();'>" + 
										"	<button id='upvote_count_" + itemID + "' name='upvote_count_" + itemID + "' class='btn btn-inverse btn-small disabled' style='min-width: 40px;'>" + itemRankCount + "</button>" + 
										"	<button id='upvote_button_" + itemID + "' name='upvote_button_" + itemID + "' class='btn btn-blue-notification btn-small' style='min-width: 40px;' onclick='upvote(" + itemID + ")'><i class='icon-arrow-up icon-white'></i></button>" + 
										"</div>";
					}
					
					// HTML
					var item_html =
						"<div id='item_" + counter + "' name='item_" + counter + "' onclick='" + itemOpenLink + "' style='cursor: pointer !important; padding-bottom: 1px; padding-left: 1px; padding-right: 1px; width:49.7%; display: inline-block;' class='hover_parent'>" +
						"<div style='padding: 0px; border: 1px solid #e1e1e8;'>" +
						" 	<div style='border-bottom: 1px solid #424242; height: 346px; background: url(" + imageURL + ") no-repeat center; background-size: contain; background-color: black; position: relative;'>" +
						playHTML +
						"	<div class='hover_child' onclick='event.stopPropagation();'><div class='bottom-up-gradient' style='bottom: 0px; margin: auto; position: absolute; opacity:1; filter: alpha(opacity=100); width: 100%;'><div style='padding: 10px; overflow: scroll; max-height: 330px;'> <div class='image-text bold'>" + itemTitle + "</div> <div class='image-text'>" + itemDescription + "</div></div></div></div>" +
						"	</div>" +
						" 	<div class='text-lead image-text' style='width: 100%; background-color: black; font-size: 17px;' onclick='event.stopPropagation();'>" + upvoteButton + "<div style='padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;'>" + counterHTML + itemTitle + "</div></div>" +
						"</div>" +
						"</div>";
					if (itemType == "text")
					{
						var item_html =
						"<div id='item_" + counter + "' name='item_" + counter + "' onclick='" + itemOpenLink + "' style='cursor: pointer !important; padding-bottom: 1px; padding-left: 1px; padding-right: 1px; width:49.7%; display: inline-block;' class='hover_parent'>" +
						"<div style='padding: 0px; border: 1px solid #e1e1e8;'>" +
						" 	<div style='border-bottom: 1px solid #424242; height: 346px; background: url(" + imageURL + ") no-repeat center; background-size: contain; background-color: black; position: relative;'>" +
						"	<div onclick='event.stopPropagation();'><div class='bottom-up-gradient' style='bottom: 0px; margin: auto; position: absolute; opacity:1; filter: alpha(opacity=100); width: 100%;'><div style='padding: 10px; overflow: scroll; max-height: 330px;'> <div class='image-text bold'>" + counterHTML + itemTitle + "</div> <div class='image-text'>" + itemDescription + "</div></div></div></div>" +
						"	</div>" +
						" 	<div class='text-lead image-text' style='width: 100%; background-color: black; font-size: 17px;' onclick='event.stopPropagation();'>" + upvoteButton + "<div style='padding: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;'>" + counterHTML + itemTitle + "</div></div>" +
						"</div>" +
						"</div>";
					}
				
					if (listFormat == "countdown") {
						$("#list_grid").prepend($(item_html));
					} else {
						$("#list_grid").append($(item_html));
					}
				}
				counter++;
			});

			// Add social calls to action
			if(json.length % 2 == 1 && listDesign == "grid")
			{
				$("#list_grid").append("");
			}
			else if(listDesign == "list")
			{
				$("#list_list").append("");
			}
			$('.scrollable').perfectScrollbar();
		}
		
		// When hidden, empty
		$('#video-item-modal').on('hidden', function () {
			_V_('videojsembed').dispose();
		    $("#video-item-modal").html("");
		})
		
		// Play a video
		function playVideo(video, width, height)
		{
			var videofile = amazon_get_file("/list/storage/list/item/display/" + video);
			$("#video-item-modal").html(
				"<video id='videojsembed' class='video-js vjs-default-skin vjs-big-play-centered' width='680' height='" + height + "'>" + 
				"	<source src='" + videofile + "' type='video/mp4' />" + 
				"	<p class='vjs-no-js'>Please update your browser like <a href='http://www.google.com/chrome/browser/'>Google Chrome</a></p>" + 
				"</video>"
			);
			videojs('videojsembed', { "controls": true, "autoplay": true, "preload": "auto" });
			$("#video-item-modal").modal('toggle');
		}
		
		// Upvote an item
		function upvote(itemid)
		{
			// Error check
			if (username.length <= 0) {
				open_tab("/list/index.php?page=signup&redirect=" + current_url);
				return false;
			}

			// Submit
			var submit_url = "/list/forms/list/update_rank.php?userpass=" + userpass + "&username=" + username + "&listid=" + listid + "&itemid=" + itemid;
			$.post(submit_url, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					if (notice.counter == "positive") {
						$("#upvote_count_" + itemid).html(parseInt($("#upvote_count_" + itemid).html()) + 1);
						$("#upvote_button_" + itemid).addClass("disabled");
					} else if (notice.counter == "negative") {
						$("#upvote_count_" + itemid).html(parseInt($("#upvote_count_" + itemid).html()) - 1);
						$("#upvote_button_" + itemid).removeClass("disabled");
					}
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
			});
		}
		
		// Upvote an item
		function check_uncheck(itemid, type)
		{
			// Error check
			if (username.length <= 0) {
				return false;
			}
			
			// If the user is not tagged or the list creator, disallow editing checklist
			if($.inArray(username, listTags) == -1)
			{
				return false;
			}

			// Submit
			var submit_url = "/list/forms/list/update_check.php?userpass=" + userpass + "&username=" + username + "&listid=" + listid + "&itemid=" + itemid;
			$.post(submit_url, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					if (notice.counter == "positive") {
						if(type == "list")
						{
							$("#checkbox_" + itemid).attr("src", "/list/lib/images/glyphicons/checked_checkbox.png");
						}
						else if(type == "grid")
						{
							$("#checkbox_" + itemid).attr("src", "/list/lib/images/glyphicons/checked_checkbox_white.png");
						}
					} else if (notice.counter == "negative") {
						if(type == "list")
						{
							$("#checkbox_" + itemid).attr("src", "/list/lib/images/glyphicons/unchecked_checkbox.png");
						}
						else if(type == "grid")
						{
							$("#checkbox_" + itemid).attr("src", "/list/lib/images/glyphicons/unchecked_checkbox_white.png");
						}
					}
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
			});
		}

		// Like the post
		function like_post() {
			// Error check
			if (username.length <= 0) {
				open_tab("/list/index.php?page=signup&redirect=" + current_url);
				return false;
			}
			$("#like_button").attr('disabled','disabled');

			// Submit
			var submit_url = "/list/forms/list/update_likes.php?userpass=" + userpass + "&username=" + username + "&userphoto=" + userphoto + "&userbadge=" + userbadge + "&fullname=" + fullname + "&listid=" + listid;
			$.post(submit_url, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					if (notice.counter == "positive") {
						$("#likes_count").html(parseInt($("#likes_count").html()) + 1);
					} else if (notice.counter == "negative") {
						$("#likes_count").html(parseInt($("#likes_count").html()) - 1);
					}
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
				$("#like_button").removeAttr('disabled');
			});
		}

		 // Relist the post
		function relist_post() {
			// Error check
			if (username.length <= 0) {
				open_tab("/list/index.php?page=signup&redirect=" + current_url);
				return false;
			}
			$("#relist_button").attr('disabled','disabled');

			var submit_url = "/list/forms/list/update_relists.php?userpass=" + userpass + "&username=" + username + "&userphoto=" + userphoto + "&userbadge=" + userbadge + "&fullname=" + fullname + "&listid=" + listid;
			$.post(submit_url, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					if (notice.counter == "positive") {
						$("#relist_count").html(parseInt($("#relist_count").html()) + 1);
					} else if (notice.counter == "negative") {
						$("#relist_count").html(parseInt($("#relist_count").html()) - 1);
					}
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
				$("#relist_button").removeAttr('disabled');
			});
		}

		 // Favorite the post
		function favorite_post() {
			// Error check
			if (username.length <= 0) {
				open_tab("/list/index.php?page=signup&redirect=" + current_url);
				return false;
			}
			$("#favorite_button").attr('disabled','disabled');

			var submit_url = "/list/forms/list/update_favorites.php?userpass=" + userpass + "&username=" + username + "&userphoto=" + userphoto + "&userbadge=" + userbadge + "&fullname=" + fullname + "&listid=" + listid;
			$.post(submit_url, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					if (notice.counter == "positive") {
						$("#favorites_count").html(parseInt($("#favorites_count").html()) + 1);
					} else if (notice.counter == "negative") {
						$("#favorites_count").html(parseInt($("#favorites_count").html()) - 1);
					}
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
				$("#favorite_button").removeAttr('disabled');
			});
		}

		 // Comment on the post
		function comment_post() {
			// Error check
			if (username.length <= 0) {
				open_tab("/list/index.php?page=signup&redirect=" + current_url);
				return false;
			}

			// Empty comment
			if ($("#comment_div").html().length <= 0) {
				return false;
			}
			var comment_text =  comment_div.innerText || comment_div.textContent;
			$("#comment_box").val(comment_text);
			$("#comment_button").attr('disabled','disabled');

			var submit_url = "/list/forms/list/update_comments.php?userpass=" + userpass + "&username=" + username + "&userphoto=" + userphoto + "&userbadge=" + userbadge + "&fullname=" + fullname + "&listid=" + listid;
			$.post(submit_url, $("#update_comments_form").serialize(), function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					refreshComments();
					$("#comment_box").val("");
					$("#comment_div").html("");
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
				$("#comment_button").removeAttr('disabled');
				$("#comment_reply_to").val("");
				$("#comment_root").val("");
			});
		}
		
		function like_comment(commentid)
		{
			// Error check
			if (username.length <= 0) {
				open_tab("/list/index.php?page=signup&redirect=" + current_url);
				return false;
			}

			// Submit
			var submit_url = '/list/forms/comment/like_comment.php?userpass=' + userpass + '&username=' + username + "&userphoto=" + userphoto + "&userbadge=" + userbadge + "&fullname=" + fullname + "&commentid=" + commentid;
			$.post(submit_url, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					if (notice.counter == "positive") {
						$("#comment_likes_count_" + commentid).html(parseInt($("#comment_likes_count_" + commentid).html()) + 1);
					} else if (notice.counter == "negative") {
						$("#comment_likes_count_" + commentid).html(parseInt($("#comment_likes_count_" + commentid).html()) - 1);
					}
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
			});
		}
		
		function reply_comment(commentid, root, username)
		{
			$("#comment_div").append("@" + username + "&nbsp;");
			$('html, body').animate({ scrollTop: $('#comment_div').offset().top - 70 }, 'fast');
			$('#comment_div').focus();
			$("#comment_reply_to").val(commentid);
			$("#comment_root").val(root);
			placeCaretAtEnd(document.getElementById("comment_div"));
		}
		
		function display_comment_likers(commentid)
		{
			$("#comment_likers_box").html("");
			show_loading("comment_likers_box");
			var get_likers_url = "/list/get/comment/likers.php?commentid=" + commentid;
			$.get(get_likers_url, function (data) {
				var json = jQuery.parseJSON(data);
				$.each(json, function (key, value) {
					var userphoto = "/list/lib/images/default/no-profile-display.png";
					if (value.userphoto.length > 0) {
						userphoto = amazon_get_file("/list/storage/user/profile/thumbnail/" + value.userphoto);
					}
					var badge = value.badge;
					var badge_html = get_badge("small-list", badge);
					$("#comment_likers_box").append(
						"<div class='prettyprint padding-10'>" +
						"<div class='row-fluid'>" +
						"	<div class='span1' style='position: relative;'><a href='/list/user/profile.php?username=" + value.username + "'><img src='" + userphoto + "' class='img-polaroid rounded' style='position: relative;'/></a> " + badge_html + "</div>" +
						"	<div class='span11 padding-left-10'>" +
						"		<div class='padding-top-10 padding-bottom-10'><strong><a href='/list/user/profile.php?username=" + value.username + "'>" + value.fullname + "</a></strong> &middot; <a href='/list/user/profile.php?username=" + value.username + "'>@" + value.username + "</a> &middot; <span class='muted'>" + value.time_ago + "</span></div>" +
						"	</div>" +
						"</div>" +
						"</div>" +
						"<div class='padding-bottom-5'></div>"
					);
				});
				if (json.length > 0)
				{
					$('#commentLikersPopup').modal('show');
				}
				hide_loading();
			});
		}
		
		function display_comment_replies(commentid, root)
		{
			$("#comment_replies_box").html("");
			show_loading("comment_replies_box");
			var get_replies_url = "/list/get/comment/replies.php?commentid=" + commentid + "&root=" + root;
			$.get(get_replies_url, function (data) {
				var json = jQuery.parseJSON(data);
				$.each(json, function (key, value) {
					var userphoto = "/list/lib/images/default/no-profile-display.png";
					if (value.userphoto.length > 0) {
						userphoto = amazon_get_file("/list/storage/user/profile/thumbnail/" + value.userphoto);
					}
					var badge = value.badge;
					var badge_html = get_badge("small-list", badge);
					$("#comment_replies_box").append(
						"<div class='prettyprint padding-10'>" +
						"	<div class='row-fluid'>" +
						"		<div class='span1' style='position: relative;'><a href='/list/user/profile.php?username=" + value.username + "'><img src='" + userphoto + "' class='img-polaroid rounded' style='position: relative;'/></a> " + badge_html + "</div>" +
						"		<div class='span11 padding-left-10' style='position: relative;'>" +
						"			<div class='padding-bottom-10'><strong><a href='/list/user/profile.php?username=" + value.username + "'>" + value.fullname + "</a></strong> <a href='/list/user/profile.php?username=" + value.username + "'>@" + value.username + "</a> &middot; <span class='muted'>" + value.time_ago + "</span> &middot; <small><a class='cursor-pointer muted bold'><i class='icon-thumbs-up'></i> <span>" + value.likes_count + "</span></a> &middot; <a class='cursor-pointer muted bold'><i class='icon-comment'></i> <span>" + value.replies_count + "</span></a></small></div>" +
						"			<div class='padding-bottom-5' style='word-wrap:break-word;'>" + value.comment + "</div>" +
						"		</div>" +
						"	</div>" +
						"</div>" + 
						"<div class='padding-bottom-5'></div>"
					);
				});
				if (json.length > 0)
				{
					$('#commentRepliesPopup').modal('show');
				}
				hide_loading();
			});
		}
		
		// Infinite scrolling
		$(window).scroll(function() {
			if ($(this).scrollTop() > $(document).height() - $(window).height() - 50) 
			{
				displayComments();
		    }
	    });

		// Refresh the comments
		function refreshComments() {
			commentsPage = 1;
			$("#comments").html("");
			displayComments();
		}
		
		// Function to open the flagging popup
		function flagCommentPopup(commentid)
		{
			flagCommentID = commentid;
			$("#flagCommentPopup").modal('toggle');
		}
		
		// Flag a comment
		function flag_comment()
		{
			var submit_url = '/list/forms/comment/flag.php?username=' + username + "&userpass=" + userpass + "&commentid=" + flagCommentID;
			$.post(submit_url, function (data) {
				var notice = jQuery.parseJSON(data);
				if (notice.error == 0) {
					device_success(notice.message);
				} else if (notice.error == 1) {
					device_alert(notice.message);
				} else if (notice.error == 2) {
					device_alert(notice.message);
					window.setTimeout(function(){ 
						window.location.href = "/list/forms/signout/signout.php"; 
					}, 5000);
				}
			});
		}

		// Display the comments
		function displayComments() {
			if (commentsPage >= 0 && !loading) {
				loading = true;
				show_loading("comments");
				var get_comments_url = "/list/get/list/comments.php?listid=" + listid + "&page=" + commentsPage;
				commentsPage++;
				$.get(get_comments_url, function (data) {
					var json = jQuery.parseJSON(data);
					$.each(json, function (key, value) {
						var userphoto = "/list/lib/images/default/no-profile-display.png";
						if (value.userphoto.length > 0) {
							userphoto = amazon_get_file("/list/storage/user/profile/thumbnail/" + value.userphoto);
						}
						var comment_close = "<a class='close' onclick='flagCommentPopup(\"" + value.commentid + "\")'><i class='icon icon-flag'></i></a>";
						if(username == value.username)
						{
							comment_close = "<a class='close' onclick='confirm_delete_comment(\"" + value.commentid + "\", \"" + value.root + "\")'>&times;</a>";
						}
						var badge = value.badge;
						var badge_html = get_badge("small-list", badge);
						$("#comments").append(
							"<div class='prettyprint padding-10'>" +
							"	<div class='row-fluid'>" +
							"		<div class='span1' style='position: relative;'><a class='hover_" + value.username + "' href='/list/user/profile.php?username=" + value.username + "'><img src='" + userphoto + "' class='img-polaroid rounded' style='position: relative;'/> " + badge_html + "</a></div>" +
							"		<div class='span11 padding-left-10' style='position: relative;'>" +
							"			<div class='padding-bottom-10'><strong class='hover_" + value.username + "'><a href='/list/user/profile.php?username=" + value.username + "'>" + value.fullname + "</a></strong> <a class='hover_" + value.username + "' href='/list/user/profile.php?username=" + value.username + "'>@" + value.username + "</a> &middot; <span class='muted'>" + value.time_ago + "</span>" + comment_close + "</div>" +
							"			<div class='padding-bottom-10' style='word-wrap:break-word;'>" + value.comment + "</div>" +
							"			<small>" + 
							"				<a class='cursor-pointer' onclick='like_comment(\"" + value.commentid + "\")'>Like</a> &middot; <a class='cursor-pointer' onclick='reply_comment(\"" + value.commentid + "\", \"" + value.root + "\", \"" + value.username + "\")'>Reply</a> &middot; <a onclick='display_comment_likers(\"" + value.commentid + "\")' class='cursor-pointer text-black bold'><i class='icon-thumbs-up'></i> <span id='comment_likes_count_" + value.commentid + "'>" + value.likes_count + "</span></a> &middot; <a onclick='display_comment_replies(\"" + value.commentid + "\", \"" + value.root + "\")' class='cursor-pointer text-black bold'><i class='icon-comment'></i> <span id='comment_replies_count_" + value.commentid + "'>" + value.replies_count + "</span></a>" + 
							"			</small>" + 
							"		</div>" +
							"	</div>" +
							"</div>" +
							"<br/>"
						);
						$(".hover_" + value.username).webuiPopover({type:'iframe', url:'/list/embed/profile.php?username=' + value.username, width: 400, height: 145, padding: false, trigger: 'hover', delay: {show: 1000, hide: null}});
					});
					if (json.length < 10) {
						commentsPage = -1;
						$('#show_more_comments_button').removeClass('btn-primary');
						$('#show_more_comments_button').attr("disabled", "disabled");
						$("#show_more_comments_button").html("No More Comments");
						if(invitationsPopup == 1)
						{
							if(username.length <= 0)
							{
								toggle_request_invite();
							}
							commentsPage = -2;
						}
					}
					hide_loading();
					loading = false;
				});
			}
		}

		function displayLikers() {
			if (likersPage >= 0) {
				show_loading("likers_box");
				var get_likers_url = "/list/get/list/likers.php?listid=" + listid + "&page=" + likersPage;
				$.get(get_likers_url, function (data) {
					var json = jQuery.parseJSON(data);
					$.each(json, function (key, value) {
						var userphoto = "/list/lib/images/default/no-profile-display.png";
						if (value.userphoto.length > 0) {
							userphoto = amazon_get_file("/list/storage/user/profile/thumbnail/" + value.userphoto);
						}
						var badge = value.badge;
						var badge_html = get_badge("small-list", badge);
						$("#likers_box").append(
							"<div class='prettyprint padding-10'>" +
							"<div class='row-fluid'>" +
							"	<div class='span1' style='position: relative;'><a href='/list/user/profile.php?username=" + value.username + "'><img src='" + userphoto + "' class='img-polaroid rounded' style='position: relative;'/> " + badge_html + "</a></div>" +
							"	<div class='span11 padding-left-10'>" +
							"		<div class='padding-top-10 padding-bottom-10'><strong><a href='/list/user/profile.php?username=" + value.username + "'>" + value.fullname + "</a></strong> &middot; <a href='/list/user/profile.php?username=" + value.username + "'>@" + value.username + "</a> &middot; <span class='muted'>" + value.time_ago + "</span></div>" +
							"	</div>" +
							"</div>" +
							"</div>" +
							"<br/>"
						);
					});
					likersPage++;
					if (json.length <= 0) {
						likersPage = -1;
						$('#show_more_likers_button').removeClass('btn-primary');
						$('#show_more_likers_button').attr("disabled", "disabled");
						$("#show_more_likers_button").html("No More Likers");
					}
					hide_loading();
				});
			}
			$('#likersPopup').modal('show');
		}

		function displayRelisters() {
			if (relistersPage >= 0) {
				show_loading("relisters_box");
				var get_relisters_url = "/list/get/list/relisters.php?listid=" + listid + "&page=" + relistersPage;
				$.get(get_relisters_url, function (data) {
					var json = jQuery.parseJSON(data);
					$.each(json, function (key, value) {
						var userphoto = "/list/lib/images/default/no-profile-display.png";
						if (value.userphoto.length > 0) {
							userphoto = amazon_get_file("/list/storage/user/profile/thumbnail/" + value.userphoto);
						}
						var badge = value.badge;
						var badge_html = get_badge("small-list", badge);
						$("#relisters_box").append(
							"<div class='prettyprint padding-10'>" +
							"<div class='row-fluid'>" +
							"	<div class='span1' style='position: relative;'><a href='/list/user/profile.php?username=" + value.username + "'><img src='" + userphoto + "' class='img-polaroid rounded' style='position: relative;'/> " + badge_html + "</a></div>" +
							"	<div class='span11 padding-left-10'>" +
							"		<div class='padding-top-10 padding-bottom-10'><strong><a href='/list/user/profile.php?username=" + value.username + "'>" + value.fullname + "</a></strong> &middot; <a href='/list/user/profile.php?username=" + value.username + "'>@" + value.username + "</a>  &middot; <span class='muted'>" + value.time_ago + "</span></div>" +
							"	</div>" +
							"</div>" +
							"</div>" +
							"<br/>"
						);
					});
					relistersPage++;
					if (json.length <= 0) {
						relistersPage = -1;
						$('#show_more_relisters_button').removeClass('btn-primary');
						$('#show_more_relisters_button').attr("disabled", "disabled");
						$("#show_more_relisters_button").html("No More Relisters");
					}
					hide_loading();
				});
			}
			$('#relistersPopup').modal('show');
		}
		
		function next_list()
		{
			open_tab("/list/user/next.php?listid=" + listid);
		}
		
		var search_url = "/list/get/search/user_autocomplete.php";
		$('#comment_div').tagautocomplete({
	      	source: function (query, process) {
	      		if(query.lastIndexOf('@') != -1)
	      		{
					query = query.substring(query.lastIndexOf('@') + 1);
	  				if(!((/[^a-zA-Z0-9]/).test(query)))
	  				{
						$.ajax({
							url: search_url,
							type: 'POST',
							dataType: 'JSON',
							data: 'query=' + query,
							success: function (data) {
								process(data);
							}
						});
	  				}
	      		}
			},
          	character: '@' // only accept @
        });
        
        function embed()
        {
        	$("#embed_website").val("<noscript><p><a href='http:\/\/www.listicle.co\/l\/" + listid + "'>" + list_title + "<\/a><\/p><\/noscript><script type='text\/javascript' src='http:\/\/www.listicle.co\/list\/lib\/plugins\/iframe-resizer\/js\/iframeResizer.min.js'><\/script><iframe src='http:\/\/www.listicle.co\/list\/embed\/list.php?listid=" + listid + "' frameborder='0' width='100%' scrolling='no'><\/iframe><script type='text\/javascript' src='http:\/\/www.listicle.co\/list\/lib\/plugins\/iframe-resizer\/js\/iframeResize.min.js'><\/script>");
        	$("#embed_wordpress").text("[Listicle " + listid + "]");
        	$("#embedPopup").modal("toggle");
        }

		// Initializations
		// Change the share input link
		listid = listid.replace(/\W/g, '');
		$(".share_input").val("http://listicle.co/l/" + listid);

		// Display List
		displayList('');
		
		// Display user related lists
		display_user_related_lists();
		
		// Display list related lists
		$(document).ready(function(){
			display_list_related_lists();
		});

		// Show the content
		$("#container").show();

		// Comment photo
		if (userphoto.length > 0) {
			var file = amazon_get_file("/list/storage/user/profile/thumbnail/" + userphoto);
			$("#comment_photo").attr("src", file);
		}
		
		//<![CDATA[
		  (function() {
		    var shr = document.createElement('script');
		    shr.setAttribute('data-cfasync', 'false');
		    shr.src = '//dsms0mj1bbhn4.cloudfront.net/assets/pub/shareaholic.js';
		    shr.type = 'text/javascript'; shr.async = 'true';
		    shr.onload = shr.onreadystatechange = function() {
		      var rs = this.readyState;
		      if (rs && rs != 'complete' && rs != 'loaded') return;
		      var site_id = '31707da3dd309ce6e3f32ddc54032d1a';
		      try { Shareaholic.init(site_id); } catch (e) {}
		    };
		    var s = document.getElementsByTagName('script')[0];
		    s.parentNode.insertBefore(shr, s);
		  })();
		//]]>
	</script>
</body>
</html>
